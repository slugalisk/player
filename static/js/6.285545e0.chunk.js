((self||this).webpackJsonp=(self||this).webpackJsonp||[]).push([[6],{5743:function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return f}),n.d(t,"a",function(){return O});var a=n(9),i=n(7),s=n(5),r=n(19),c=n(8),o=n(3),u=n(2),l=n(88),h=n(89),d=n(21),p=n(25),v=n.n(p),b=n(5744),f=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(u.a)(this,e),this.queue=[],this.dhtClient=t.dhtClient||new h.a(Object(b.a)()),this.ppsppClient=t.ppsppClient||new l.a},O=function(){function e(t){Object(u.a)(this,e),this.server=t}return Object(o.a)(e,[{key:"bootstrap",value:function(){var e=this,t=Object(b.a)(),n={type:"bootstrap",bootstrapId:v()(this.server.dhtClient.id),id:v()(t)},a=m.open(),i=this.createClient(a);return i.on("datachannel",function(n){var a=n.channel;"dht"===a.label?e.server.dhtClient.createChannel(t,a):"ppspp"===a.label&&e.server.ppsppClient.createChannel(a)}),this.server.queue.push(i),this.server.queue.length>6&&this.server.queue.shift().close(),Promise.resolve({data:n,conn:a.remote})}},{key:"createClient",value:function(e){var t=new y(e),n=new j(t);return t.on("connection",function(){return e.close()}),n}}]),e}(),m=function(t){function n(e){var t;return Object(u.a)(this,n),(t=Object(i.a)(this,Object(s.a)(n).call(this))).remote=e||new n(Object(r.a)(t)),t.remote.remote=Object(r.a)(t),t.readyState=t.remote.readyState||n.ReadyStates.CONNECTING,t.onmessage=function(){},t}return Object(c.a)(n,t),Object(o.a)(n,[{key:"send",value:function(t){var a=this;this.readyState===n.ReadyStates.OPEN&&e(function(){a.remote.emit("message",{data:t}),a.remote.onmessage({data:t})})}},{key:"addEventListener",value:function(){this.on.apply(this,arguments)}},{key:"removeEventListener",value:function(){this.removeListener.apply(this,arguments)}},{key:"open",value:function(){this.readyState=n.ReadyStates.OPEN,this.remote.readyState=n.ReadyStates.OPEN,this.emit("open")}},{key:"close",value:function(){this.readyState=n.ReadyStates.CLOSING,this.remote.readyState=n.ReadyStates.CLOSING,this.remote.emit("close"),this.emit("close"),this.readyState=n.ReadyStates.CLOSED,this.remote.readyState=n.ReadyStates.CLOSED,this.removeAllListeners(),this.remote.removeAllListeners()}}],[{key:"open",value:function(){var e=new n;return e.open(),e.remote.open(),e}}]),n}(d.EventEmitter);m.ReadyStates={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed"};var y=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(i.a)(this,Object(s.a)(t).call(this))).conn=e,n.conn.onmessage=n.handleMessage.bind(Object(r.a)(n)),n}return Object(c.a)(t,e),Object(o.a)(t,[{key:"handleMessage",value:function(e){var t=JSON.parse(e.data);switch(t.type){case"connection":this.handleConnection(t);break;default:this.emit("error",new Error("unsupported mediator event type"))}}},{key:"handleConnection",value:function(e){var n=this,i=e.id,s=t.datachannels[i];delete t.datachannels[i],Object.entries(s).forEach(function(e){var t=Object(a.a)(e,2),i=t[0],s=t[1];return n.emit("datachannel",i,s)}),this.emit("open")}},{key:"sendConnection",value:function(e){var n=t.nextId++;t.datachannels[n]=e,this.conn.send(JSON.stringify({type:"connection",id:n})),this.emit("open")}}]),t}(d.EventEmitter);y.nextId=0,y.datachannels={};var j=function(t){function n(e){var t;return Object(u.a)(this,n),(t=Object(i.a)(this,Object(s.a)(n).call(this))).mediator=e,t.datachannels={},t.conns=[],e.on("datachannel",t.handleDataChannel.bind(Object(r.a)(t))),e.once("open",t.handleOpen.bind(Object(r.a)(t))),t}return Object(c.a)(n,t),Object(o.a)(n,[{key:"handleDataChannel",value:function(e,t){var n=new C(this,e,t);this.conns.push(n),this.emit("datachannel",{label:e,channel:n})}},{key:"handleOpen",value:function(){var t=this;e(function(){t.conns.forEach(function(e){return e.open()}),t.emit("open")})}},{key:"createDataChannel",value:function(e){var t=new C(this,e);return this.datachannels[e]=t,this.conns.push(t),t}},{key:"init",value:function(){this.mediator.sendConnection(this.datachannels)}},{key:"close",value:function(){this.closed||(this.closed=!0,this.conns.forEach(function(e){return e.close()}),this.emit("close"),this.removeAllListeners())}}]),n}(d.EventEmitter),C=function(e){function t(e,n,a){var r;return Object(u.a)(this,t),(r=Object(i.a)(this,Object(s.a)(t).call(this,a))).client=e,r.label=n,r}return Object(c.a)(t,e),t}(m)}).call(this,n(75).setImmediate)},5744:function(e,t,n){"use strict";var a=n(97),i=n.n(a);t.a=function(){var e=new Uint8Array(16);return i.a.randomFillSync(e),e}},5794:function(e,t,n){"use strict";n.r(t);var a=n(47),i=n(9),s=n(0),r=n.n(s),c=n(5743),o=n(132),u=n(131),l=n(130);n(237);t.default=function(){var e=Object(s.useState)(new c.b),t=Object(i.a)(e,1)[0],n=Object(s.useState)([]),h=Object(i.a)(n,2),d=h[0],p=h[1],v=Object(s.useState)(""),b=Object(i.a)(v,2),f=b[0],O=b[1];Object(s.useEffect)(function(){var e=new u.d;return e.on("publish",function(e){var n=e.injector.swarm;O(n.uri),t.ppsppClient.publishSwarm(n)}),e.on("unpublish",function(e){var n=e.injector.swarm;t.ppsppClient.unpublishSwarm(n)}),e.start({bitRate:9e6}),function(){return e.stop()}},[]);var m=d.map(function(e,t){return r.a.createElement(l.a,{key:t,swarm:e,containerClass:"diagnostic-menu--indent-".concat(t)})});return r.a.createElement("div",null,m,r.a.createElement("button",{onClick:function(){o.a.create(new c.a(t)).then(function(e){var t=e.ppsppClient.joinSwarm(f);p([].concat(Object(a.a)(d),[t])),new u.b(t).on("data",function(e){return console.log("received ".concat(e.length," bytes"))})})}},"add peer"))}}}]);
//# sourceMappingURL=6.285545e0.chunk.js.map