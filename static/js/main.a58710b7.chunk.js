((self||this).webpackJsonp=(self||this).webpackJsonp||[]).push([[0],{108:function(e,t,n){},112:function(e,t,n){"use strict";var a=n(71),i=n.n(a);t.a=function(){var e=new Uint8Array(16);return i.a.randomFillSync(e),e}},165:function(e,t,n){"use strict";(function(e){var a=n(9),i=n(1),r=n.n(i),s=n(79),u=n(56),c=n(168),o=n(57),h=n(176),l=n(51),d=n(80),f=n(179),v=n.n(f);n(108);t.a=function(t){var n=Object(i.useState)(null),f=Object(a.a)(n,2),p=f[0],g=f[1],b=Object(i.useState)(""),m=Object(a.a)(b,2),y=m[0],k=m[1],O=Object(i.useState)(""),w=Object(a.a)(O,2),j=w[0],C=w[1],S=Object(i.useState)(null),E=Object(a.a)(S,2),I=E[0],A=E[1],R=function(e){var t=Object(i.useState)({}),n=Object(a.a)(t,2),r=n[0],s=n[1];return Object(i.useEffect)(function(){s(v.a.parse(e,{ignoreQueryPrefix:!0})||{})},[e]),[r]}(t.location.search),D=Object(a.a)(R,1)[0],M="autoplay"in D;Object(i.useEffect)(function(){var e="https:"===window.location.protocol?"wss":"ws",t=window.location.host,n="".concat(e,"://").concat(t);console.log({bootstrapAddress:n});var a=new h.a(n);o.a.create(a).then(function(e){var t=e.ppsppClient,n=e.bootstrap,a=n.swarmUri,i=n.injectorType;g(t),k(a),C(i)})},[]);var L=function(){console.log(y);var e=s.a.parse(y);console.log("joining",e);var t=p.joinSwarm(e);"noise"===j&&new l.b(t).on("data",function(e){return console.log("received ".concat(e.length," bytes"))}),A(t)};Object(i.useEffect)(function(){M&&y&&e(L)},[y,D]);var B;return I?"noise"===j?r.a.createElement(u.a,{swarm:I}):r.a.createElement(c.a,{swarm:I}):(B="show_form"in D?r.a.createElement("form",{className:"join-form",onSubmit:function(e){e.preventDefault(),L()}},r.a.createElement("input",{onChange:function(e){k(e.target.value)},placeholder:"Enter Swarm URI",defaultValue:y}),r.a.createElement("button",null,"Join")):r.a.createElement(d.a,{disabled:""===y,onClick:L,pulse:!M,spin:""===y,flicker:M,blur:!0}),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"idle"},r.a.createElement("div",{className:"noise"})),B))}}).call(this,n(72).setImmediate)},168:function(e,t,n){"use strict";(function(e){var a=n(61),i=n.n(a),r=n(169),s=n(9),u=n(1),c=n.n(u),o=n(170),h=n.n(o),l=n(51),d=n(56),f=n(10),v=n(80);n(319);t.a=function(t){var n=t.swarm,a=Object(u.useRef)(null),o=function(t){var n=Object(u.useState)(),a=Object(s.a)(n,2),i=a[0],r=a[1];Object(u.useEffect)(function(){var e=new MediaSource;r(e),e.addEventListener("sourceopen",function(){return c(e)})},[]);var c=function(n){var a=n.addSourceBuffer('video/mp4; codecs="mp4a.40.5,avc1.64001F"');a.addEventListener("error",function(e){return console.log(e)});var i=[],r=function t(n){if(void 0===n||0===i.length&&!a.updating){if(!a.updating){var r=n||i.shift();if(void 0!==r)try{a.appendBuffer(r)}catch(s){i.unshift(r),e(t)}}}else i.push(n)};a.addEventListener("updateend",function(){return r()});var s=new h.a.mp4.Transmuxer,u=!1;s.on("data",function(e){if("combined"===e.type){var t=u?e.data:f.Buffer.concat([f.Buffer.from(e.initSegment),f.Buffer.from(e.data)]);u=!0,r(t)}else console.log("unhandled event",e.type)});var c=new l.a(t);c.on("start",function(e){return s.push(e)}),c.on("data",function(e){return s.push(e)}),c.on("end",function(e){s.push(e),s.flush()})};return[i]}(n),p=Object(s.a)(o,1)[0],g=Object(u.useState)(!1),b=Object(s.a)(g,2),m=b[0],y=b[1],k=Object(u.useState)(!1),O=Object(s.a)(k,2),w=O[0],j=O[1],C=Object(u.useState)(!1),S=Object(s.a)(C,2),E=S[0],I=S[1],A=Object(u.useState)(!0),R=Object(s.a)(A,2),D=R[0],M=R[1],L=Object(u.useState)(!0),B=Object(s.a)(L,2),x=B[0],T=B[1],N=Object(u.useState)(null),P=Object(s.a)(N,2),H=P[0],q=P[1];console.log({paused:E,volume:H}),Object(u.useEffect)(function(){if(null!=a.current&&null!=p){a.current.src=URL.createObjectURL(p),q(a.current.volume),a.current.addEventListener("audioprocess",function(e){return console.log((new Date).toUTCString(),"audioprocess",e)}),a.current.addEventListener("canplay",function(e){return console.log((new Date).toUTCString(),"canplay",e)}),a.current.addEventListener("canplaythrough",function(e){return console.log((new Date).toUTCString(),"canplaythrough",e)}),a.current.addEventListener("complete",function(e){return console.log((new Date).toUTCString(),"complete",e)}),a.current.addEventListener("durationchange",function(e){return console.log((new Date).toUTCString(),"durationchange",e)}),a.current.addEventListener("emptied",function(e){return console.log((new Date).toUTCString(),"emptied",e)}),a.current.addEventListener("ended",function(e){return console.log((new Date).toUTCString(),"ended",e)}),a.current.addEventListener("loadeddata",function(e){return console.log((new Date).toUTCString(),"loadeddata",e)}),a.current.addEventListener("loadedmetadata",function(e){return console.log((new Date).toUTCString(),"loadedmetadata",e)}),a.current.addEventListener("pause",function(e){return console.log((new Date).toUTCString(),"pause",e)}),a.current.addEventListener("play",function(e){return console.log((new Date).toUTCString(),"play",e)}),a.current.addEventListener("playing",function(e){return console.log((new Date).toUTCString(),"playing",e)}),a.current.addEventListener("ratechange",function(e){return console.log((new Date).toUTCString(),"ratechange",e)}),a.current.addEventListener("seeked",function(e){return console.log((new Date).toUTCString(),"seeked",e)}),a.current.addEventListener("seeking",function(e){return console.log((new Date).toUTCString(),"seeking",e)}),a.current.addEventListener("stalled",function(e){return console.log((new Date).toUTCString(),"stalled",e)}),a.current.addEventListener("suspend",function(e){return console.log((new Date).toUTCString(),"suspend",e)}),a.current.addEventListener("volumechange",function(e){return console.log((new Date).toUTCString(),"volumechange",e)}),a.current.addEventListener("waiting",function(e){return console.log((new Date).toUTCString(),"waiting",e)});var e=function(){j(!1),M(!1)},t=function(){j(!1),M(!1)},n=function(){j(!1)},i=function(){I(!1),j(!0),y(!0)},r=function(){T(!1)},s=function(){q(a.current.volume)},u=function(){j(!1),T(!0)};return a.current.addEventListener("ended",e),a.current.addEventListener("complete",t),a.current.addEventListener("pause",n),a.current.addEventListener("playing",i),a.current.addEventListener("canplay",r),a.current.addEventListener("volumechange",s),a.current.addEventListener("waiting",u),U(),function(){a.current.removeEventListener("ended",e),a.current.removeEventListener("complete",t),a.current.removeEventListener("pause",n),a.current.removeEventListener("playing",i),a.current.removeEventListener("canplay",r),a.current.removeEventListener("volumechange",s),a.current.removeEventListener("waiting",u)}}},[a,p]);var U=function(){var e=Object(r.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.current.play();case 3:e.next=16;break;case 5:return e.prev=5,e.t0=e.catch(0),a.current.muted=!0,e.prev=8,e.next=11,a.current.play();case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(8),console.warn("error playing video",e.t1);case 16:case"end":return e.stop()}},e,null,[[0,5],[8,13]])}));return function(){return e.apply(this,arguments)}}(),_=c.a.createElement(v.a,{visible:!w,onClick:U,blur:!m,flicker:D&&!m,spin:x&&m,disabled:x||!m});return c.a.createElement(c.a.Fragment,null,c.a.createElement(d.a,{swarm:n}),c.a.createElement("video",{onClick:function(e){return e.preventDefault()},className:"swarm-player-video",ref:a}),_)}}).call(this,n(72).setImmediate)},171:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return g});var a=n(8),i=n(5),r=n(7),s=n(6),u=n(3),c=n(4),o=n(20),h=n(71),l=n.n(h),d=n(42),f=n(79),v=n(2),p=n(59),g=function(){function t(n,a,i){Object(u.a)(this,t),this.swarm=n,this.chunkSize=a,this.chunksPerSignature=i,this.inputBuffer=e.alloc(0),this.chunkBuffer=[]}return Object(c.a)(t,[{key:"appendData",value:function(t){var n=this;if(this.inputBuffer.length+t.length<this.chunkSize)this.inputBuffer=e.concat([this.inputBuffer,t]);else{var a=0;this.inputBuffer.length>0&&(a=this.chunkSize-this.inputBuffer.length,this.chunkBuffer.push(e.concat([this.inputBuffer,t.slice(0,a)],this.chunkSize)));for(var i=a;i+this.chunkSize<t.length;i+=this.chunkSize)this.chunkBuffer.push(t.slice(i,Math.min(t.length,i+this.chunkSize))),a=i+this.chunkSize;a<t.length&&(this.inputBuffer=t.slice(a));for(var r=function(){var e=n.chunkBuffer.splice(0,n.chunksPerSignature);n.swarm.contentIntegrity.appendSubtree(e).then(function(t){n.swarm.chunkBuffer.setRange(t.rootAddress,e),n.swarm.scheduler.markChunksLoaded(t.rootAddress)})};this.chunkBuffer.length>this.chunksPerSignature;)r()}}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.chunkSize,a=void 0===n?8192:n,i=e.chunksPerSignature,r=void 0===i?64:i,u=e.liveDiscardWindow,c=void 0===u?Math.ceil(5376e4/a):u,o=e.chunkAddressingMethod,h=void 0===o?v.a.Bin32:o,l=e.contentIntegrityProtectionMethod,g=void 0===l?v.b.UnifiedMerkleTree:l,b=e.merkleHashTreeFunction,m=void 0===b?v.e.SHA256:b,y=e.liveSignatureAlgorithm,k=void 0===y?v.c.ECDSAP256SHA256:y;return Object(d.f)(k).then(function(e){var t,n=e.swarmId,i=e.privateKey,r=new f.a(n,(t={},Object(s.a)(t,v.g.ContentIntegrityProtectionMethod,g),Object(s.a)(t,v.g.MerkleHashTreeFunction,m),Object(s.a)(t,v.g.LiveSignatureAlgorithm,k),Object(s.a)(t,v.g.ChunkAddressingMethod,h),Object(s.a)(t,v.g.ChunkSize,a),t));console.log("swarm uri:",r.toString());var u={liveDiscardWindow:c,privateKey:i,uploadRateLimit:1e7};return new p.b(r,u)}).then(function(e){return new t(e,a,r)})}}]),t}();o.EventEmitter}).call(this,n(10).Buffer)},176:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var a=n(19),i=n(8),r=n(5),s=n(17),u=n(7),c=n(3),o=n(4),h=n(20),l=n(177),d=n.n(l),f=n(85),v=function(){function e(t){Object(c.a)(this,e),this.bootstrapAddress=t}return Object(o.a)(e,[{key:"bootstrap",value:function(){var e=this;return new Promise(function(t,n){var a=new d.a(e.bootstrapAddress);a.onmessage=function(e){var i=JSON.parse(e.data);"bootstrap"===i.type?t({data:i,conn:a}):n(new Error("expected bootstrap, received: ".concat(e.data)))}})}},{key:"createClient",value:function(e){var t=new p(e),n=new g(t);return t.once("error",function(){return e.close()}),n.once("open",function(){return e.close()}),n}}]),e}(),p=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this))).conn=e,n.conn.onmessage=n.handleMessage.bind(Object(s.a)(n)),n}return Object(u.a)(t,e),Object(o.a)(t,[{key:"handleMessage",value:function(e){var t=JSON.parse(e.data);switch(t.type){case"offer":case"answer":this.emit("remotedescription",new f.RTCSessionDescription(t));break;case"icecandidate":t.sdp&&t.sdp.candidate&&this.emit("icecandidate",new f.RTCIceCandidate(t.sdp));break;default:this.emit("error",new Error("unsupported mediator event type"))}}},{key:"sendOffer",value:function(e){this.send(e)}},{key:"sendAnswer",value:function(e){this.send(e)}},{key:"sendIceCandidate",value:function(e){e.candidate&&this.send({type:"icecandidate",sdp:e.candidate})}},{key:"send",value:function(e){1===this.conn.readyState?this.conn.send(JSON.stringify(e)):console.log("mediator tried to send after closing its connection")}}]),t}(h.EventEmitter),g=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this))).mediator=e,n.initialized=!1,n.waitingChannels=0,n.peerConn=new f.RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),n.peerConn.addEventListener("icecandidate",function(e){return n.mediator.sendIceCandidate(e)}),n.peerConn.addEventListener("datachannel",n.handleDataChannel.bind(Object(s.a)(n))),n.peerConn.addEventListener("iceconnectionstatechange",n.handleIceConnectionStateChange.bind(Object(s.a)(n))),e.once("error",function(){return n.peerConn.close()}),e.on("icecandidate",function(e){return n.addIceCandidate(e)}),n._ready=new Promise(function(t,a){e.on("remotedescription",function(e){n.peerConn.setRemoteDescription(e).then(function(){t(),n.createAnswer()}).catch(a)})}),n}return Object(u.a)(t,e),Object(o.a)(t,[{key:"createAnswer",value:function(){var e=this;this.initialized||(this.initialized=!0,this.peerConn.createAnswer().then(function(t){e.peerConn.setLocalDescription(t),e.mediator.sendAnswer(t)}).catch(function(e){return console.error(e)}))}},{key:"addIceCandidate",value:function(e){var t=this;this._ready.then(function(){return t.peerConn.addIceCandidate(e)})}},{key:"handleDataChannel",value:function(e){e.channel.binaryType="arraybuffer",this.waitingChannels++,e.channel.addEventListener("open",this.resolveWaitingChannel.bind(this),{once:!0}),this.emit("datachannel",e)}},{key:"createDataChannel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object(a.a)({ordered:!0,maxRetransmits:10},t);var n=this.peerConn.createDataChannel(e,t);return n.binaryType="arraybuffer",this.waitingChannels++,n.addEventListener("open",this.resolveWaitingChannel.bind(this),{once:!0}),n}},{key:"resolveWaitingChannel",value:function(){0===--this.waitingChannels&&this.emit("open")}},{key:"handleIceConnectionStateChange",value:function(){"failed"===this.peerConn.iceConnectionState&&this.peerConn.close()}},{key:"init",value:function(){var e=this;this.peerConn.createOffer().then(function(t){e.initialized=!0,e.peerConn.setLocalDescription(t),e.mediator.sendOffer(t)})}},{key:"close",value:function(){this.peerConn.close(),this.emit("close")}}]),t}(h.EventEmitter)},177:function(e,t,n){e.exports=n(106)?n(325):n(326)},189:function(e,t,n){e.exports=n(367)},198:function(e,t,n){},2:function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"g",function(){return s}),n.d(t,"h",function(){return u}),n.d(t,"b",function(){return c}),n.d(t,"e",function(){return o}),n.d(t,"c",function(){return h}),n.d(t,"a",function(){return l}),n.d(t,"f",function(){return d});var a=n(166),i=n.n(a),r=4294967295,s={Version:0,MinimumVersion:1,SwarmIdentifier:2,ContentIntegrityProtectionMethod:3,MerkleHashTreeFunction:4,LiveSignatureAlgorithm:5,ChunkAddressingMethod:6,LiveDiscardWindow:7,SupportedMessages:8,ChunkSize:9,EndOption:255},u={RFC7574:1},c={None:0,MerkleHashTree:1,SignAll:2,UnifiedMerkleTree:3},o={SHA1:0,SHA224:1,SHA256:2,SHA384:3,SHA512:4},h={RSASHA1:5,RSASHA256:8,ECDSAP256SHA256:13,ECDSAP384SHA384:14},l={Bin32:0,ByteRange64:1,ChunkRange32:2,Bin64:3,ChunkRange64:4},d={HANDSHAKE:0,DATA:1,ACK:2,HAVE:3,INTEGRITY:4,PEX_RESv4:5,PEX_REQ:6,SIGNED_INTEGRITY:7,REQUEST:8,CANCEL:9,CHOKE:10,UNCHOKE:11,PEX_RESv6:12,PEX_REScert:13};[s,u,c,o,h,l,d].forEach(function(e){var t=i()(e);e.name=function(e){return t[e]||"UNDEFINED"}})},21:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var a=n(9),i=n(3),r=n(4),s=n(2),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.binBounds(t);Object(i.a)(this,e),this.bin=t;var r=Object(a.a)(n,2);this.start=r[0],this.end=r[1]}return Object(r.a)(e,[{key:"containsBin",value:function(e){return this.start<=e&&e<=this.end}},{key:"getChunkCount",value:function(){return(this.end-this.start)/2+1}}],[{key:"from",value:function(t){if(t instanceof e)return t;switch(t.type){case s.a.Bin32:return new e(t.value);case s.a.ChunkRange32:var n=t.start,a=t.end;return new e((a-n)/2,[n,a]);default:throw new Error("unsupported address type")}}},{key:"binBounds",value:function(e){return[e&e+1,(e|e+1)-1]}}]),e}()},222:function(e,t){},224:function(e,t){},257:function(e,t){},258:function(e,t){},304:function(e,t,n){e.exports=n(106)?n(305):n(317)},305:function(e,t,n){"use strict";n.r(t),function(e){var t=n(172),a=n.n(t);e.exports=new a.a}.call(this,n(155)(e))},317:function(e,t){e.exports=crypto},318:function(e,t,n){},319:function(e,t,n){},325:function(e,t,n){"use strict";n.r(t);var a=n(178),i=n.n(a);t.default=i.a},326:function(e,t){e.exports=WebSocket},327:function(e,t,n){"use strict";n.r(t),function(e){var t=n(86);e.exports={RTCPeerConnection:t.RTCPeerConnection,RTCSessionDescription:t.RTCSessionDescription,RTCIceCandidate:t.RTCIceCandidate}}.call(this,n(155)(e))},328:function(e,t){e.exports={RTCPeerConnection:window.RTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate}},36:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var a=n(174),i=n.n(a);function r(e){return new Uint8Array(i()(e))}},366:function(e,t,n){},367:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),r=n(164),s=n.n(r),u=n(369),c=n(371),o=n(370),h=n(165),l=n(24),d=n(9),f=n(52),v=n(57),p=n(51),g=n(56),b=(n(108),function(){var e=Object(a.useState)(new f.b),t=Object(d.a)(e,1)[0],n=Object(a.useState)([]),r=Object(d.a)(n,2),s=r[0],u=r[1],c=Object(a.useState)(""),o=Object(d.a)(c,2),h=o[0],b=o[1];Object(a.useEffect)(function(){var e=new p.c;return e.on("publish",function(e){var n=e.swarm;b(n.uri),t.ppsppClient.publishSwarm(n)}),e.on("unpublish",function(e){var n=e.swarm;t.ppsppClient.unpublishSwarm(n)}),e.start(),function(){return e.stop()}},[]);var m=s.map(function(e,t){return i.a.createElement(g.a,{key:t,swarm:e,containerClass:"diagnostic-menu--indent-".concat(t)})});return i.a.createElement("div",null,m,i.a.createElement("button",{onClick:function(){v.a.create(new f.a(t)).then(function(e){var t=e.ppsppClient.joinSwarm(h);u([].concat(Object(l.a)(s),[t])),new p.b(t).on("data",function(e){return console.log("received ".concat(e.length," bytes"))})})}},"add peer"))}),m=n(19),y=n(188),k=n(16),O=n.n(k),w=n(187),j=n(83),C=n(82),S=Object(C.b)(j.a),E=function(e,t){var n=t.type,a=Object(y.a)(t,["type"]);switch(n){case"ADD_NODE":return{nodes:[].concat(Object(l.a)(e.nodes),[a]),links:e.links};case"REMOVE_NODE":return{nodes:e.nodes.filter(function(e){return e.id!==a.id}),links:e.links.filter(function(e){var t=e.source,n=e.target;return t.id!==a.id&&n.id!==a.id})};case"ADD_LINK":return{nodes:e.nodes,links:[].concat(Object(l.a)(e.links),[Object(m.a)({},a,{activity:0})])};case"UPDATE_LINK":return{nodes:e.nodes,links:e.links.map(function(e){var t=e.source,n=e.target;return t.id!==a.source||n.id!==a.target?e:Object(m.a)({},e,a)})};case"INCR_LINK_ACTIVITY":return{nodes:e.nodes,links:e.links.map(function(e){var t=e.source,n=e.target;return t.id!==a.source||n.id!==a.target?e:Object(m.a)({},e,{activity:e.activity+1})})};case"DECR_LINK_ACTIVITY":return{nodes:e.nodes,links:e.links.map(function(e){var t=e.source,n=e.target;return t.id!==a.source||n.id!==a.target?e:Object(m.a)({},e,{activity:e.activity-1})})};case"REMOVE_LINK":return console.log(a),{nodes:e.nodes,links:e.links.filter(function(e){var t=e.source,n=e.target;return t.id!==a.source||n.id!==a.target})};default:return e}},I=function(){var e=function(){var e=Object(a.useState)([new f.b]),t=Object(d.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(1),s=Object(d.a)(r,2),u=s[0],c=s[1],o=Object(a.useReducer)(E,{nodes:[],links:[]}),h=Object(d.a)(o,2),p=h[0],g=h[1];Object(a.useEffect)(function(){var e=O()(n[0].dhtClient.id);g({type:"ADD_NODE",id:e,color:"#fff",dhtClient:n[0].dhtClient}),b(3).then(function(e){return e.map(function(e){var t=e.dhtClient,n=e.ppsppClient;return new f.b({dhtClient:t,ppsppClient:n})})}).then(function(e){return i([].concat(Object(l.a)(n),Object(l.a)(e)))})},[]);var b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(u+1);var a=Promise.all(new Array(e).fill(0).map(function(){var e=n.length-1,t=Math.min(e,1+Math.floor(Math.random()*e)),a=n[t];return v.a.create(new f.a(a))}));return a.then(function(e){return e.forEach(function(e){var n=e.dhtClient,a=n.id,i=n.allChannels;console.log(i);var r=O()(a);g(Object(m.a)({type:"ADD_NODE",id:r,color:S(u),dhtClient:n},t)),n.on("close",function(){return g({type:"REMOVE_NODE",id:r})}),i.toArray().forEach(function(e){e.isOpen()&&g({type:"ADD_LINK",source:r,target:O()(e.id),color:e.isOpen()?"#fff":"#66f"})}),i.on("added",function(e){if(e.isOpen()){var t=O()(e.id);g({type:"ADD_LINK",source:r,target:t,color:e.isOpen()?"#fff":"#66f"})}}),i.on("updated",function(e,t){if(e.isOpen()!==t.isOpen()){var n=O()(t.id);g({type:"ADD_LINK",source:r,target:n,color:t.isOpen()?"#fff":"#66f"})}}),i.on("removed",function(e){var t=e.id;return g({type:"REMOVE_LINK",source:r,target:O()(t)})})})}),a};return[p,{addNodes:b,deleteNodes:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0;t<e;t++){var a=n.length,i=p.nodes[a+Math.floor(Math.random()*(Object.keys(p.nodes).length-a))];i&&i.dhtClient.close()}}}]}(),t=Object(d.a)(e,2),n=t[0],r=t[1],s=r.addNodes,u=r.deleteNodes,c=function(){var e=Object(a.useState)(null),t=Object(d.a)(e,2),n=t[0],i=t[1];return function(e){if(console.log(e),null===n)return i(e),void console.log("set source",O()(e.dhtClient.id));console.log("pinging %s > %s",O()(n.dhtClient.id),O()(e.dhtClient.id)),n.dhtClient.sendPing(e.dhtClient.id,function(e){console.log("received ping response",e)}),i(null)}}();return console.log(n),i.a.createElement("div",null,i.a.createElement("div",{className:"graph-buttons"},i.a.createElement("button",{onClick:function(){return s(1)}},"add 1 peer"),i.a.createElement("button",{onClick:function(){return s(5)}},"add 5 peers"),i.a.createElement("button",{onClick:function(){return s(10)}},"add 10 peers"),i.a.createElement("button",{onClick:function(){return u(1)}},"delete 1 peer"),i.a.createElement("button",{onClick:function(){return u(5)}},"delete 5 peers")),i.a.createElement(w.a,{graphData:n,nodeAutoColorBy:"gen",onNodeClick:c,linkColor:function(e){return e.color},linkWidth:1.5,nodeRelSize:2,nodeVal:function(e){return e.dhtClient.allChannels.count()}}))},A=function(){return i.a.createElement(u.a,null,i.a.createElement(c.a,null,i.a.createElement(o.a,{exact:!0,path:"/",component:h.a}),i.a.createElement(o.a,{exact:!0,path:"/test",component:b}),i.a.createElement(o.a,{exact:!0,path:"/dht-graph",component:I})))};n(366);s.a.render(i.a.createElement(A,null),document.getElementById("root"))},42:function(e,t,n){"use strict";var a=n(8),i=n(5),r=n(31),s=n(7),u=n(24),c=n(61),o=n.n(c),h=n(3),l=n(4),d=n(9),f=n(19),v=n(6),p=n(10),g=n(43),b=n.n(g);var m,y,k,O=n(21),w=n(55),j=n(2);n.d(t,"a",function(){return I}),n.d(t,"e",function(){return A}),n.d(t,"c",function(){return D}),n.d(t,"d",function(){return M}),n.d(t,"f",function(){return L}),n.d(t,"b",function(){return x});var C=n(304),S=function(e){return new Uint8Array(e)},E=(m={},Object(v.a)(m,j.e.SHA1,"SHA-1"),Object(v.a)(m,j.e.SHA224,"SHA-224"),Object(v.a)(m,j.e.SHA256,"SHA-256"),Object(v.a)(m,j.e.SHA384,"SHA-384"),Object(v.a)(m,j.e.SHA512,"SHA-512"),m),I=(y={},Object(v.a)(y,j.e.SHA1,20),Object(v.a)(y,j.e.SHA224,28),Object(v.a)(y,j.e.SHA256,32),Object(v.a)(y,j.e.SHA384,48),Object(v.a)(y,j.e.SHA512,64),y),A=function(e){var t=E[e];if(void 0===t)throw new Error("invalid merkle hash tree function");var n=new Uint8Array(I[e]);return function(){for(var e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];return(a=a.map(function(e){return void 0===e?n:e})).every(function(e){return b()(e,n)})?Promise.resolve(n):(a=a.length>1?new Uint8Array(p.Buffer.concat(a.map(function(e){return p.Buffer.from(e)}))):a[0],C.subtle.digest(t,a).then(S))}},R=(k={},Object(v.a)(k,j.c.RSASHA1,{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}}),Object(v.a)(k,j.c.RSASHA256,{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}}),Object(v.a)(k,j.c.ECDSAP256SHA256,{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}}),Object(v.a)(k,j.c.ECDSAP384SHA384,{name:"ECDSA",namedCurve:"P-384",hash:{name:"SHA-384"}}),k),D=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object(f.a)({},R[e],n);var a=C.subtle.importKey("pkcs8",t,n,!1,["sign"]);return function(e){return a.then(function(t){return C.subtle.sign(n,t,e)}).then(S)}},M=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n=Object(f.a)({},R[e],t.getKeyParams(),n);var a=new Uint8Array(t.publicKey),i=C.subtle.importKey("spki",a,n,!1,["verify"]);return function(e,t){return i.then(function(a){return C.subtle.verify(n,a,e,t)}).then(S)}},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t=Object(f.a)({},R[e],t),C.subtle.generateKey(t,!0,["sign","verify"]).then(function(e){return Promise.all([C.subtle.exportKey("pkcs8",e.privateKey),C.subtle.exportKey("spki",e.publicKey)])}).then(function(n){var a=Object(d.a)(n,2),i=a[0],r=a[1];return{privateKey:i,publicKey:r,swarmId:w.a.from(Object(f.a)({},t,{liveSignatureAlgorithm:e,publicKey:r}))}})},B=function(){return Promise.reject("live signature function not available")},x=function(e,t,n){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,f=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(h.a)(this,e),this.hash=t,this.verified=n}return Object(l.a)(e,[{key:"markVerified",value:function(){this.verified=!0}},{key:"getHash",value:function(){return this.hash}},{key:"compare",value:function(e){return this.verified?Promise.resolve(b()(this.hash,e)):Promise.reject("cannot use unverified signature")}}]),e}(),v=function(){function e(t,n){Object(h.a)(this,e),this.signature=t,this.hash=n,this.verificationResult=void 0}return Object(l.a)(e,[{key:"verifyHash",value:function(){var e=this;return void 0===this.verificationResult&&(this.verificationResult=n(this.hash,this.getHash()).then(function(){return e.markVerified()})),this.verificationResult}},{key:"markVerified",value:function(){this.signature.markVerified()}},{key:"getHash",value:function(){return this.signature.getHash()}},{key:"getSignatureHash",value:function(){return this.hash}},{key:"compare",value:function(e){var t=this;return this.verifyHash().then(function(){return t.signature.compare(e)})}}]),e}(),p=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(2*t.getChunkCount()-1);Object(h.a)(this,e),this.rootAddress=t,this.signatures=n}return Object(l.a)(e,[{key:"createVerifier",value:function(){return new g(this)}},{key:"copy",value:function(e){for(var t=0;t<this.signatures.length;t++)void 0===e.signatures[t]&&(e.signatures[t]=this.signatures[t])}},{key:"getChunkCount",value:function(){return this.rootAddress.getChunkCount()}},{key:"getConstituentHashBins",value:o.a.mark(function e(t){var n,a,i,r,s,u,c;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.bin,this.rootAddress.containsBin(n)){e.next=3;break}throw new Error("bin out of range");case 3:a=this.rootAddress.start,n-=a,i=[],r=this.rootAddress.getChunkCount()+n/2-1,s=2,u=n;case 9:if(0===r){e.next=18;break}return c=1===(1&r)?1:-1,e.next=13,{isRoot:!1,branch:c,bin:u+a,bfsIndex:r,siblingBin:u+c*s+a,siblingBfsIndex:r+c};case 13:r=Math.floor((r-1)/2),u+=c*s/2,s*=2,e.next=9;break;case 18:return e.next=20,{isRoot:!0,branch:0,bin:u+a,bfsIndex:0,siblingBin:u+a,siblingBfsIndex:0};case 20:return e.abrupt("return",i);case 21:case"end":return e.stop()}},e,this)})},{key:"getConstituentSignatures",value:function(e){var t=this;return Array.from(this.getConstituentHashBins(e)).map(function(e){var n=e.siblingBin,a=e.siblingBfsIndex;return{bin:n,signature:t.signatures[a]}})}}],[{key:"from",value:function(n){for(var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O.a(e.minSize(n.length)-1),i=a.getChunkCount(),r=new Array(2*i-1),s=0;s<i;s++)r[s+i-1]=t(n[s]);for(var o=2*(i-1);o>0;o-=2)r[Math.floor(o/2)-1]=Promise.all([r[o-1],r[o]]).then(function(e){return t.apply(void 0,Object(u.a)(e))});return Promise.all(r).then(function(t){var n=t.map(function(e){return new f(e,!0)});return c(t[0]).then(function(t){return n[0]=new v(n[0],t),new e(a,n)})})}},{key:"minSize",value:function(e){return Math.pow(2,Math.ceil(Math.log2(e)))}}]),e}(),g=function(){function e(t){Object(h.a)(this,e),this.hashTree=t,this.signatures={}}return Object(l.a)(e,[{key:"setHash",value:function(e,t){var n=e.bin;this.signatures[n]=new f(t)}},{key:"setHashSignature",value:function(e,t){var n=e.bin;this.signatures[n]=new v(this.signatures[n],t)}},{key:"verifyChunk",value:function(e,n){var a=this,i=[],r=t(n),s=!0,u=!1,c=void 0;try{for(var o,h=function(){var e=o.value,n=a.hashTree.signatures[e.siblingBfsIndex];void 0===n&&(n=a.signatures[e.siblingBin],i.push({index:e.siblingBfsIndex,signature:n}));var s=a.hashTree.signatures[e.bfsIndex];return void 0!==s?(r=r.then(function(e){return s.compare(e)}),"break"):e.isRoot?(r=r.then(function(e){return n.compare(e)}),"break"):void(r=r.then(function(a){i.push({index:e.bfsIndex,signature:new f(a)});var r=n.getHash(),s=1===e.branch?[a,r]:[r,a];return t.apply(void 0,s)}))},l=this.hashTree.getConstituentHashBins(e)[Symbol.iterator]();!(s=(o=l.next()).done);s=!0){if("break"===h())break}}catch(d){u=!0,c=d}finally{try{s||null==l.return||l.return()}finally{if(u)throw c}}return r.then(function(){i.forEach(function(e){var t=e.index,n=e.signature;n.markVerified(),a.hashTree.signatures[t]=n})})}}]),e}(),m=function(){function e(){Object(h.a)(this,e),this.subtrees=[],this.nextStart=0,this.chunkCount=0}return Object(l.a)(e,[{key:"findSubtree",value:function(e){var t=this,n=e.bin,a=function(e,t){for(var n=0,a=e;n<=a;){var i=n+Math.floor((a-n)/2),r=t(i);if(r<0)n=i+1;else{if(!(r>0))return i;a=i-1}}return-(n+1)}(this.subtrees.length-1,function(e){var a=t.subtrees[e].rootAddress,i=a.start,r=a.end;return i<=n&&n<=r?0:i-n});return a<0?void 0:this.subtrees[a]}},{key:"insertSubtree",value:function(e){var t=this.findSubtree(e.rootAddress);return void 0!==t?(t!==e&&e.copy(t),t):(this.subtrees.push(e),this.subtrees.sort(function(e,t){return e.rootAddress.start-t.rootAddress.start}),this.chunkCount+=e.getChunkCount(),this.pruneSubtrees(),e)}},{key:"pruneSubtrees",value:function(){for(;this.subtrees.length>0&&this.chunkCount-this.subtrees[0].getChunkCount()>d;){var e=this.subtrees.shift();this.chunkCount-=e.getChunkCount()}}},{key:"appendSubtree",value:function(e){var t=this,n=p.minSize(e.length),a=new O.a(this.nextStart+n-1,[this.nextStart,this.nextStart+2*(n-1)]);return this.nextStart+=2*n,p.from(e,a).then(function(e){return t.insertSubtree(e)})}},{key:"createVerifier",value:function(e){var t=this.findSubtree(e)||new p(e);return new y(this,t)}},{key:"getConstituentSignatures",value:function(e){var t=this.findSubtree(e);if(void 0!==t)return t.getConstituentSignatures(e)}}]),e}(),y=function(e){function t(e,n){var r;return Object(h.a)(this,t),(r=Object(a.a)(this,Object(i.a)(t).call(this,n))).unifiedHashTree=e,r}return Object(s.a)(t,e),Object(l.a)(t,[{key:"verifyChunk",value:function(e,n){return Object(r.a)(Object(i.a)(t.prototype),"verifyChunk",this).call(this,e,n).then(this.unifiedHashTree.insertSubtree(this.hashTree))}}]),t}(g),k=function(){function e(){Object(h.a)(this,e)}return Object(l.a)(e,[{key:"setHash",value:function(){}},{key:"setHashSignature",value:function(){}},{key:"verifyChunk",value:function(){return Promise.resolve()}}]),e}(),w=function(){function e(){Object(h.a)(this,e)}return Object(l.a)(e,[{key:"createVerifier",value:function(){return new k}},{key:"getConstituentSignatures",value:function(){return[]}}]),e}();switch(e){case j.b.None:return new w;case j.b.MerkleHashTree:return new p;case j.b.UnifiedMerkleTree:return new m;default:throw new Error("unsupported content integrity protection method")}}},51:function(e,t,n){"use strict";(function(e){n.d(t,"c",function(){return v}),n.d(t,"a",function(){return g}),n.d(t,"b",function(){return b});var a=n(17),i=n(3),r=n(4),s=n(8),u=n(5),c=n(7),o=n(20),h=n(171),l=e.from("4c93bf00ae13c37e5df3b7a9cea0413521fe1b08a627d065d7180b9d0738c666","hex"),d=l.length,f=function(t){function n(e){var t;return Object(i.a)(this,n),(t=Object(s.a)(this,Object(u.a)(n).call(this))).injector=e,t}return Object(c.a)(n,t),Object(r.a)(n,[{key:"write",value:function(t){var n=e.alloc(4);n.writeUInt32BE(t.length),this.injector.appendData(e.concat([l,e.from([0]),n,l,e.from([1]),n],74)),this.injector.appendData(t)}}]),n}(o.EventEmitter),v=function(t){function n(){return Object(i.a)(this,n),Object(s.a)(this,Object(u.a)(n).apply(this,arguments))}return Object(c.a)(n,t),Object(r.a)(n,[{key:"start",value:function(){var t=this,n=e.alloc(437500);n.fill(255),h.a.create().then(function(e){t.injector=e;var a=new f(e);t.intervalId=setInterval(function(){return a.write(n)},1e3),t.emit("publish",e)})}},{key:"stop",value:function(e){clearInterval(this.intervalId),this.emit("unpublish",this.injector),e&&setTimeout(e)}}]),n}(o.EventEmitter),p=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this))).swarm=e,n.handleWarmupSwarmData=n.handleWarmupSwarmData.bind(Object(a.a)(n)),n.handleSwarmData=n.handleSwarmData.bind(Object(a.a)(n)),n.chunkBufferLength=0,n.nextDataOffset=0,n.nextDataLength=0,n.swarm.on("data",n.handleWarmupSwarmData),n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"handleWarmupSwarmData",value:function(e){for(var t=0;t<e.length;t++){var n=e[t].indexOf(l);if(!(-1===n||n+37>e[t].length)){this.swarm.removeListener("data",this.handleWarmupSwarmData),this.swarm.on("data",this.handleSwarmData),this.readHeader(e[t],n),this.handleSwarmData(e.slice(t));break}}}},{key:"readHeader",value:function(e,t){var n=e.readUInt8(t+d);this.nextDataOffset=t+37*(2-n),this.nextDataLength=e.readUInt32BE(t+d+1)}},{key:"handleSwarmData",value:function(e){for(var t=0;t<e.length;t++){var n=this.chunkBufferLength;this.chunkBufferLength+=e[t].length;var a=this.nextDataOffset+this.nextDataLength;if(this.chunkBufferLength<a)this.handleData(e[t],n);else{var i=a-n;if(this.handleEndData(e[t],i),this.chunkBufferLength-a<=37)return this.swarm.removeListener("data",this.handleSwarmData),this.swarm.on("data",this.handleWarmupSwarmData),this.chunkBufferLength=0,void this.handleWarmupSwarmData(e.slice(t));this.chunkBufferLength=0,this.readHeader(e[t],i),t--}}}}]),t}(o.EventEmitter),g=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).firstEmitted=!1,n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"handleData",value:function(e,t){this.firstEmitted?this.emit("data",e):this.chunkBufferLength>this.nextDataOffset&&(this.emit("start",e.slice(this.nextDataOffset-t)),this.firstEmitted=!0)}},{key:"handleEndData",value:function(e,t){this.emit("end",e.slice(0,t)),this.firstEmitted=!1}}]),t}(p),b=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).chunkBuffer=[],n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"handleData",value:function(e){this.chunkBuffer.push(e)}},{key:"handleEndData",value:function(e,t){this.chunkBuffer.push(e);var n=this.chunkBuffer.slice();n[n.length-1]=n[n.length-1].slice(0,t);var a=this.nextDataOffset;a>n[0].length&&(a-=n[0].length,n.shift()),n[0]=n[0].slice(a),this.emit("data",{chunks:n,length:this.nextDataLength}),this.chunkBuffer=[]}}]),t}(p)}).call(this,n(10).Buffer)},52:function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return g}),n.d(t,"a",function(){return b});var a=n(9),i=n(8),r=n(5),s=n(17),u=n(7),c=n(4),o=n(3),h=n(59),l=n(62),d=n(20),f=n(16),v=n.n(f),p=n(112),g=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this.queue=[],this.dhtClient=t.dhtClient||new l.a(Object(p.a)()),this.ppsppClient=t.ppsppClient||new h.a},b=function(){function e(t){Object(o.a)(this,e),this.server=t}return Object(c.a)(e,[{key:"bootstrap",value:function(){var e=this,t=Object(p.a)(),n={type:"bootstrap",bootstrapId:v()(this.server.dhtClient.id),id:v()(t)},a=m.open(),i=this.createClient(a);return i.on("datachannel",function(n){var a=n.channel;"dht"===a.label?e.server.dhtClient.createChannel(t,a):"ppspp"===a.label&&e.server.ppsppClient.createChannel(a)}),this.server.queue.push(i),this.server.queue.length>6&&this.server.queue.shift().close(),Promise.resolve({data:n,conn:a.remote})}},{key:"createClient",value:function(e){var t=new y(e),n=new k(t);return t.on("connection",function(){return e.close()}),n}}]),e}(),m=function(t){function n(e){var t;return Object(o.a)(this,n),(t=Object(i.a)(this,Object(r.a)(n).call(this))).remote=e||new n(Object(s.a)(t)),t.remote.remote=Object(s.a)(t),t.readyState=t.remote.readyState||n.ReadyStates.CONNECTING,t.onmessage=function(){},t}return Object(u.a)(n,t),Object(c.a)(n,[{key:"send",value:function(t){var a=this;this.readyState===n.ReadyStates.OPEN&&e(function(){a.remote.emit("message",{data:t}),a.remote.onmessage({data:t})})}},{key:"addEventListener",value:function(){this.on.apply(this,arguments)}},{key:"removeEventListener",value:function(){this.removeListener.apply(this,arguments)}},{key:"open",value:function(){this.readyState=n.ReadyStates.OPEN,this.remote.readyState=n.ReadyStates.OPEN,this.emit("open")}},{key:"close",value:function(){this.readyState=n.ReadyStates.CLOSING,this.remote.readyState=n.ReadyStates.CLOSING,this.remote.emit("close"),this.emit("close"),this.readyState=n.ReadyStates.CLOSED,this.remote.readyState=n.ReadyStates.CLOSED,this.removeAllListeners(),this.remote.removeAllListeners()}}],[{key:"open",value:function(){var e=new n;return e.open(),e.remote.open(),e}}]),n}(d.EventEmitter);m.ReadyStates={CONNECTING:"connecting",OPEN:"open",CLOSING:"closing",CLOSED:"closed"};var y=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(i.a)(this,Object(r.a)(t).call(this))).conn=e,n.conn.onmessage=n.handleMessage.bind(Object(s.a)(n)),n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"handleMessage",value:function(e){var t=JSON.parse(e.data);switch(t.type){case"connection":this.handleConnection(t);break;default:this.emit("error",new Error("unsupported mediator event type"))}}},{key:"handleConnection",value:function(e){var n=this,i=e.id,r=t.datachannels[i];delete t.datachannels[i],Object.entries(r).forEach(function(e){var t=Object(a.a)(e,2),i=t[0],r=t[1];return n.emit("datachannel",i,r)}),this.emit("open")}},{key:"sendConnection",value:function(e){var n=t.nextId++;t.datachannels[n]=e,this.conn.send(JSON.stringify({type:"connection",id:n})),this.emit("open")}}]),t}(d.EventEmitter);y.nextId=0,y.datachannels={};var k=function(t){function n(e){var t;return Object(o.a)(this,n),(t=Object(i.a)(this,Object(r.a)(n).call(this))).mediator=e,t.datachannels={},t.conns=[],e.on("datachannel",t.handleDataChannel.bind(Object(s.a)(t))),e.once("open",t.handleOpen.bind(Object(s.a)(t))),t}return Object(u.a)(n,t),Object(c.a)(n,[{key:"handleDataChannel",value:function(e,t){var n=new O(this,e,t);this.conns.push(n),this.emit("datachannel",{label:e,channel:n})}},{key:"handleOpen",value:function(){var t=this;e(function(){t.conns.forEach(function(e){return e.open()}),t.emit("open")})}},{key:"createDataChannel",value:function(e){var t=new O(this,e);return this.datachannels[e]=t,this.conns.push(t),t}},{key:"init",value:function(){this.mediator.sendConnection(this.datachannels)}},{key:"close",value:function(){this.closed||(this.closed=!0,this.conns.forEach(function(e){return e.close()}),this.emit("close"),this.removeAllListeners())}}]),n}(d.EventEmitter),O=function(e){function t(e,n,a){var s;return Object(o.a)(this,t),(s=Object(i.a)(this,Object(r.a)(t).call(this,a))).client=e,s.label=n,s}return Object(u.a)(t,e),t}(m)}).call(this,n(72).setImmediate)},55:function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return u});var a=n(3),i=n(4),r=n(2),s=function(e){return[r.c.RSASHA1,r.c.RSASHA256].includes(e)},u=function(){function t(n,i,r,s){Object(a.a)(this,t),this.liveSignatureAlgorithm=n,this.publicKey=e.from(i),this.publicExponent=r,this.modulusLength=s}return Object(i.a)(t,[{key:"getLiveSignatureByteLength",value:function(){switch(this.liveSignatureAlgorithm){case r.c.RSASHA1:case r.c.RSASHA256:return this.modulusLength/8;case r.c.ECDSAP256SHA256:return 64;case r.c.ECDSAP384SHA384:return 96;default:throw new Error("unsupported live signature algorithm")}}},{key:"getKeyParams",value:function(){return s(this.liveSignatureAlgorithm)?{publicExponent:new Uint8Array(this.publicExponent),modulusLength:this.modulusLength}:{}}},{key:"byteLength",value:function(){var e=s(this.liveSignatureAlgorithm)?9:1;return this.publicKey.length+e}},{key:"toBuffer",value:function(){var t=e.alloc(this.byteLength()),n=0;return t.writeUInt8(this.liveSignatureAlgorithm,n),n+=1,s(this.liveSignatureAlgorithm)&&(e.from(this.publicExponent).copy(t,n+4-this.publicExponent.length),n+=4,t.writeUInt32BE(this.modulusLength,n),n+=4),this.publicKey.copy(t,n),t}},{key:"read",value:function(e){var t=0;this.liveSignatureAlgorithm=e.readUInt8(0),t+=1,s(this.liveSignatureAlgorithm)&&(this.publicExponent=e.slice(t,t+4),t+=4,this.modulusLength=e.readUInt32BE(t),t+=4),this.publicKey=e.slice(t)}}],[{key:"from",value:function(n){if(ArrayBuffer.isView(n)){var a=Object.create(t.prototype);return a.read(e.from(n)),a}return new t(n.liveSignatureAlgorithm,n.publicKey,n.publicExponent,n.modulusLength)}}]),t}()}).call(this,n(10).Buffer)},56:function(e,t,n){"use strict";var a=n(9),i=n(3),r=n(4),s=n(8),u=n(5),c=n(7),o=n(1),h=n.n(o),l=n(60),d=n.n(l),f=n(167),v=n.n(f),p=n(82),g=(n(198),function(e){function t(){return Object(i.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=d()({diagnostic_menu__toggle_button:!0,"diagnostic_menu__toggle_button--expanded":this.props.expanded});return h.a.createElement("button",{onClick:this.props.onClick,className:e})}}]),t}(o.Component));g.defaultProps={expanded:!1};var b=function(e){return isFinite(e)?v()(e):String(e)},m=function(e){function t(){return Object(i.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.value.scheduler,t=[{key:"totalSends",value:b(e.totalSends)},{key:"totalRequests",value:b(e.totalRequests)},{key:"totalRequestsReceived",value:b(e.totalRequestsReceived)},{key:"totalDroppedRequests",value:b(e.totalDroppedRequests)},{key:"totalReceived",value:b(e.totalReceived)},{key:"totalAdded",value:b(e.totalAdded)},{key:"totalCancelled",value:b(e.totalCancelled)},{key:"ackUnknownSend",value:b(e.ackUnknownSend)},{key:"lastCompletedBin",value:e.lastCompletedBin},{key:"picker.firstLoadedChunk",value:e.loadedChunks.min()},{key:"picker.firstRequestedChunk",value:e.requestedChunks.min()},{key:"chunkRate",value:b(e.chunkRate.value())}].map(function(e){var t=e.key,n=e.value;return h.a.createElement("tr",{key:t},h.a.createElement("td",{className:"diagnostic_table__key_cell"},t),h.a.createElement("td",null,n))});return h.a.createElement("div",{className:"swarm_state__container"},h.a.createElement("table",null,h.a.createElement("tbody",null,t)))}}]),t}(o.Component),y=function(e){function t(){return Object(i.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this.props.value,t=[{key:"chunkIntervalMean",value:b(e.chunkIntervalMean.value())},{key:"wasteRate",value:b(e.wasteRate.value())},{key:"chunkRate",value:b(e.chunkRate.value())},{key:"ledbat.baseDelay",value:b(e.ledbat.baseDelay.getMin())},{key:"ledbat.currentDelay",value:b(e.ledbat.currentDelay.getMin())},{key:"ledbat.rttMean",value:b(e.ledbat.rttMean.value())},{key:"ledbat.rttVar",value:b(e.ledbat.rttVar.value())},{key:"ledbat.cwnd",value:b(e.ledbat.cwnd)},{key:"ledbat.cto",value:b(e.ledbat.cto)},{key:"ledbat.flightSize",value:b(e.ledbat.flightSize)},{key:"validChunks",value:b(e.validChunks)},{key:"requestQueue.length",value:b(e.requestQueue.length)},{key:"requestedChunks.length",value:b(e.requestedChunks.length)}].map(function(e){var t=e.key,n=e.value;return h.a.createElement("tr",{key:t},h.a.createElement("td",{className:"diagnostic_table__key_cell"},t),h.a.createElement("td",null,n))}),n=this.props,a=n.startBin,i=n.endBin;return t.push(h.a.createElement("tr",{key:"availableChunks"},h.a.createElement("td",{colSpan:"2"},"Available",h.a.createElement(k,{value:this.props.value.availableChunks,startBin:a,endBin:i})))),t.push(h.a.createElement("tr",{key:"sentChunks"},h.a.createElement("td",{colSpan:"2"},"Sent",h.a.createElement(k,{value:this.props.value.sentChunks,startBin:a,endBin:i})))),t.push(h.a.createElement("tr",{key:"receivedChunks"},h.a.createElement("td",{colSpan:"2"},"Received",h.a.createElement(k,{value:this.props.value.receivedChunks,startBin:a,endBin:i})))),h.a.createElement("table",null,h.a.createElement("tbody",null,t))}}]),t}(o.Component),k=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).canvas=h.a.createRef(),n.scratchCanvas=document.createElement("canvas"),n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"componentDidUpdate",value:function(){if(this.canvas.current){var e=this.props.value,t=isNaN(this.props.startBin)?e.min():this.props.startBin,n=isNaN(this.props.endBin)?e.max():this.props.endBin;if(isFinite(t)&&isFinite(n)&&!isNaN(t)&&!isNaN(n)){this.scratchCanvas.height=this.props.height,this.scratchCanvas.width=this.props.width;var a=this.scratchCanvas.getContext("2d"),i=Object(p.a)().domain([t,n]).range([0,this.props.width]);a.fillStyle="white",a.fillRect(0,0,this.props.width,this.props.height),a.fillStyle="#ccc";for(var r=-1,s=t;s<=n;s+=2)e.values.get((s+2)/2)&&s!==n?-1===r&&(r=s):-1!==r&&(a.fillRect(i(r),0,i(s)-i(r),20),r=-1);this.canvas.current.getContext("2d").drawImage(this.scratchCanvas,0,0)}}}},{key:"render",value:function(){return h.a.createElement("canvas",{height:this.props.height,width:this.props.width,ref:this.canvas})}}]),t}(o.Component);k.defaultProps={width:300,height:20};var O=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).handleButtonClick=function(){n.setState({expanded:!n.state.expanded})},n.state={expanded:!1},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e;return this.state.expanded&&(e=h.a.createElement(y,{value:this.props.value,startBin:this.props.startBin,endBin:this.props.endBin})),h.a.createElement("div",{className:"peer_state__container"},h.a.createElement("div",{className:"peer_state__header"},h.a.createElement(g,{onClick:this.handleButtonClick,expanded:this.state.expanded}),h.a.createElement("h4",{className:"peer_state__title"},this.props.value.peer.localId," : ",this.props.value.peer.remoteId)),e)}}]),t}(o.Component),w=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).handleButtonClick=function(){n.setState({expanded:!n.state.expanded}),n.scheduleUpdate()},n.handleUpdate=function(){n.state.expanded&&n.forceUpdate(n.scheduleUpdate)},n.scheduleUpdate=function(){window.requestAnimationFrame(n.handleUpdate)},n.state={expanded:!1},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e,t,n=d()(this.props.containerClass,{diagnostic_menu__container:!0,"diagnostic_menu__container--expanded":this.state.expanded}),i=this.props.swarm.scheduler,r=i.lastCompletedBin,s=i.liveDiscardWindow,u=r-s,c=r+s;return this.state.expanded&&(e=h.a.createElement(m,{value:this.props.swarm,startBin:u,endBin:c}),t=Object.entries(this.props.swarm.scheduler.peerStates).map(function(e){var t=Object(a.a)(e,2),n=t[0],i=t[1];return h.a.createElement(O,{key:n,value:i,startBin:u,endBin:c})})),h.a.createElement("div",{className:n},h.a.createElement(g,{onClick:this.handleButtonClick,expanded:this.state.expanded}),e,t)}}]),t}(o.Component);t.a=w},57:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var a=n(3),i=n(4),r=n(59),s=n(62),u=n(36),c=function(){function e(t,n,i){Object(a.a)(this,e);var c=Object(u.a)(i.id),o=Object(u.a)(i.bootstrapId);this.connManager=t,this.bootstrap=i,this.swarmUri=i.swarmUri;var h=t.createClient(n);this.dhtClient=new s.a(c),this.dhtClient.on("peers.discover",this.handlePeersDiscover.bind(this)),this.dhtClient.on("receive.connect.request",this.handleReceiveConnectRequest.bind(this)),this.dhtClient.createChannel(o,h.createDataChannel("dht")),this.ppsppClient=new r.a,this.ppsppClient.createChannel(h.createDataChannel("ppspp")),h.init()}return Object(i.a)(e,[{key:"handlePeersDiscover",value:function(e){var t=new s.b(this.dhtClient,e),n=this.connManager.createClient(t),a=n.createDataChannel("dht"),i=n.createDataChannel("ppspp"),r=setTimeout(function(){return n.close()},1e4);a.addEventListener("close",function(){return n.close()}),this.dhtClient.createChannel(e,a),this.ppsppClient.createChannel(i),this.dhtClient.send(e,"connect.request",{channelId:t.id},function(){clearTimeout(r),n.init()})}},{key:"handleReceiveConnectRequest",value:function(e){var t=this,n=e.data,a=n.channelId,i=n.from,r=e.callback,c=new u.a(i);this.connManager.createClient(new s.b(this.dhtClient,c,a)).on("datachannel",function(e){var n=e.channel;"dht"===n.label?t.dhtClient.createChannel(c,n):"ppspp"===n.label&&t.ppsppClient.createChannel(n)}),r({})}}],[{key:"create",value:function(t){return t.bootstrap().then(function(n){var a=n.data,i=n.conn;return new e(t,i,a)})}}]),e}()},59:function(e,t,n){"use strict";var a=n(17),i=n(24),r=n(19),s=n(6),u=n(9),c=n(3),o=n(4),h=n(8),l=n(5),d=n(7),f=n(20),v=n(173),p=n.n(v),g=n(21),b=n(55),m=function(){function e(t){Object(c.a)(this,e),this.mean=0,this.alpha=t,this.weight=1}return Object(o.a)(e,[{key:"update",value:function(e){this.mean=this.alpha*e+(1-this.alpha)*this.mean,this.weight*=this.alpha}},{key:"set",value:function(e){this.mean=e,this.weight=0}},{key:"isEmpty",value:function(){return 1===this.weight}},{key:"value",value:function(){return this.mean/(1-this.weight)}}]),e}(),y=function(){function e(t){Object(c.a)(this,e),this.setCapacity(t)}return Object(o.a)(e,[{key:"setCapacity",value:function(e){this.capacity=e,this.lastIndex=e,this.values=new Array(e);for(var t=0;t<e;t++)this.values[t]=this.createEmptyValue(t)}},{key:"advanceLastIndex",value:function(e){if(!(this.lastIndex>e)){var t=this.lastIndex;e-t>this.capacity&&(t=e-this.capacity);for(var n=t;n<=e;n++){var a=n%this.capacity;this.values[a]=this.createEmptyValue(n,this.values[a])}this.lastIndex=e+1}}},{key:"createEmptyValue",value:function(){}},{key:"set",value:function(e,t){this.advanceLastIndex(e),this.values[e%this.capacity]=t}},{key:"get",value:function(e){if(!(e<this.lastIndex-this.capacity||e>=this.lastIndex))return this.values[e%this.capacity]}},{key:"push",value:function(e){this.set(this.lastIndex,e)}}]),e}(),k=function(e){function t(e,n){var a;return Object(c.a)(this,t),(a=Object(h.a)(this,Object(l.a)(t).call(this,e))).min=1/0,a.window=n,a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"createEmptyValue",value:function(){return 1/0}},{key:"getMin",value:function(){return this.min}},{key:"update",value:function(e){var t=Math.floor(Date.now()/this.window);t>=this.lastIndex&&(this.advanceLastIndex(t),this.min=Math.min.apply(Math,Object(i.a)(this.values))),e<this.get(t)&&(this.set(t,e),this.min=Math.min(this.min,e))}}]),t}(y),O=100,w=4,j=1e3,C=10,S=6e4,E=2,I=8192,A=.125,R=.25,D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I;Object(c.a)(this,e),this.target=t,this.mss=n,this.flightSize=0,this.cwnd=E*I,this.cto=1e3,this.currentDelay=new k(w,j),this.baseDelay=new k(C,S),this.lastDataLoss=0,this.lastAckTime=1/0,this.rttMean=new m(A),this.rttVar=new m(R),this.ackSize=0}return Object(o.a)(e,[{key:"addSent",value:function(e){this.flightSize+=e}},{key:"addDelaySample",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I;this.currentDelay.update(e),this.baseDelay.update(e),this.ackSize+=t,this.lastAckTime=Date.now()}},{key:"digestDelaySamples",value:function(){if(this.checkCTO(),0!==this.ackSize){var e=Math.abs(this.currentDelay.getMin()-this.baseDelay.getMin()),t=(this.target-e)/this.target;this.cwnd+=1*t*this.ackSize*this.mss/this.cwnd;var n=this.flightSize+1*this.mss;this.cwnd=Math.max(Math.min(this.cwnd,n),2*this.mss),this.flightSize=Math.max(0,this.flightSize-this.ackSize),this.ackSize=0}}},{key:"checkCTO",value:function(){this.flightSize>0&&Date.now()-this.cto>this.lastAckTime&&(this.cwnd=this.mss,this.cto=2*this.cto)}},{key:"addRttSample",value:function(e){this.rttMean.isEmpty()?(this.rttMean.set(e),this.rttVar.set(e/2)):(this.rttVar.update(Math.abs(this.rttMean.value()-e)),this.rttMean.update(e)),this.cto=this.rttMean.value()+Math.max(1,4*this.rttVar.value()),this.cto<1e3&&(this.cto=1e3)}},{key:"onDataLoss",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Date.now();0!==this.lastDataLoss&&n-this.lastDataLoss<this.rttMean.value()||(this.lastDataLoss=n,this.cwnd=Math.min(this.cwnd,Math.max(this.cwnd/2,2*this.mss)),t||(this.flightSize=Math.max(0,this.flightSize-e)))}}],[{key:"computeOneWayDelay",value:function(e){return Date.now()-e}}]),e}(),M=n(10),L=n(42),B=n(2),x=function(e,t){var n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(c.a)(this,e),this.type=B.a.Bin32,this.value=t}return Object(o.a)(e,[{key:"read",value:function(e,t){return this.value=e.readUInt32BE(t),4}},{key:"byteLength",value:function(){return 4}},{key:"write",value:function(e,t){e.writeUInt32BE(this.value,t)}},{key:"rangeByteLength",value:function(){var e=g.a.binBounds(this.value),n=Object(u.a)(e,2),a=n[0];return(n[1]-a+1)*t}}],[{key:"from",value:function(t){return new e(t.bin)}}]),e}(),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(c.a)(this,e),this.type=B.a.ChunkRange32,this.start=t,this.end=n}return Object(o.a)(e,[{key:"read",value:function(e,t){return this.start=e.readUInt32BE(t),this.end=e.readUInt32BE(t+4),8}},{key:"byteLength",value:function(){return 8}},{key:"write",value:function(e,t){e.writeUInt32BE(this.start,t),e.writeUInt32BE(this.end,t+4)}},{key:"rangeByteLength",value:function(){return(this.end-this.start+1)*t}}],[{key:"from",value:function(t){return new e(t.start,t.end)}}]),e}();switch(e){case B.a.Bin32:return n;case B.a.ChunkRange32:return a;default:throw new Error("unsupported chunk addressing method")}},T=function(e){return function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.Buffer.alloc(e);Object(c.a)(this,t),this.value=M.Buffer.from(n)}return Object(o.a)(t,[{key:"read",value:function(t,n){return t.copy(this.value,0,n,n+e),e}},{key:"byteLength",value:function(){return e}},{key:"write",value:function(e,t){this.value.copy(e,t)}}]),t}()},N=function(e,t){var n=t.getLiveSignatureByteLength();return function(t){function n(t){var a;return Object(c.a)(this,n),(a=Object(h.a)(this,Object(l.a)(n).call(this,t))).type=e,a}return Object(d.a)(n,t),n}(T(n))},P=function(e){var t=L.a[e];return function(t){function n(t){var a;return Object(c.a)(this,n),(a=Object(h.a)(this,Object(l.a)(n).call(this,t))).type=e,a}return Object(d.a)(n,t),n}(T(t))},H=function(e,t,n){var a,r,u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(c.a)(this,e),this.value=t}return Object(o.a)(e,[{key:"read",value:function(e,t){return this.value=e.readUInt8(t),1}},{key:"byteLength",value:function(){return 1}},{key:"write",value:function(e,t){e.writeUInt8(this.value,t)}}]),e}(),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(c.a)(this,e),this.value=t}return Object(o.a)(e,[{key:"read",value:function(e,t){return this.value=e.readUInt32BE(t),4}},{key:"byteLength",value:function(){return 4}},{key:"write",value:function(e,t){e.writeUInt32BE(this.value,t)}}]),e}(),v=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.h.RFC7574;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.Version,e}return Object(d.a)(t,e),t}(u),p=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.h.RFC7574;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.MinimumVersion,e}return Object(d.a)(t,e),t}(u),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(c.a)(this,e),this.type=B.g.SwarmIdentifier,this.value=M.Buffer.from(t)}return Object(o.a)(e,[{key:"read",value:function(e,t){var n=e.readUInt16BE(t);return t+=2,this.value=e.slice(t,t+n),n+2}},{key:"byteLength",value:function(){return this.value.length+2}},{key:"write",value:function(e,t){e.writeUInt16BE(this.value.length,t),this.value.copy(e,t+2)}}]),e}(),b=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.b.MerkleHashTree;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.ContentIntegrityProtectionMethod,e}return Object(d.a)(t,e),t}(u),m=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.e.SHA256;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.MerkleHashTreeFunction,e}return Object(d.a)(t,e),t}(u),y=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.c.ECDSAP256SHA256;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.LiveSignatureAlgorithm,e}return Object(d.a)(t,e),t}(u),k=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.a.ChunkRange32;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.ChunkAddressingMethod,e}return Object(d.a)(t,e),t}(u),O=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.LiveDiscardWindow,e}return Object(d.a)(t,e),t}(f),w=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.values(B.f).filter(function(e){return!isNaN(e)});Object(c.a)(this,e),this.type=B.g.SupportedMessages,this.value={},n.forEach(function(e){return t.value[e]=!0})}return Object(o.a)(e,[{key:"read",value:function(e,t){var n=e.readUInt8(t);t+=1;for(var a=0;a<n;a++)for(var i=e[t+a],r=0;r<8;r++)this.value[8*a+r]=Boolean(i&1<<7-r);return n+1}},{key:"bitmapByteLength",value:function(){return Math.ceil(Math.max.apply(Math,Object(i.a)(Object.keys(this.value)))/8)+1}},{key:"toBitmap",value:function(){for(var e=this.bitmapByteLength(),t=M.Buffer.alloc(e),n=0;n<e;n++){for(var a=0,i=0;i<8;i++)a=a<<1|(this.value[8*n+i]?1:0);t.writeUInt8(a,n)}return t}},{key:"byteLength",value:function(){return this.bitmapByteLength()+1}},{key:"write",value:function(e,t){var n=this.toBitmap();e.writeUInt8(n.length,t),n.copy(e,t+1)}}]),e}(),j=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).type=B.g.ChunkSize,e}return Object(d.a)(t,e),t}(f),C=(a={},Object(s.a)(a,B.g.Version,v),Object(s.a)(a,B.g.MinimumVersion,p),Object(s.a)(a,B.g.SwarmIdentifier,g),Object(s.a)(a,B.g.ContentIntegrityProtectionMethod,b),Object(s.a)(a,B.g.MerkleHashTreeFunction,m),Object(s.a)(a,B.g.LiveSignatureAlgorithm,y),Object(s.a)(a,B.g.ChunkAddressingMethod,k),Object(s.a)(a,B.g.LiveDiscardWindow,O),Object(s.a)(a,B.g.SupportedMessages,w),Object(s.a)(a,B.g.ChunkSize,j),a),S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.a)(this,e),this.type=B.f.HANDSHAKE,this.channelId=t,this.options=n}return Object(o.a)(e,[{key:"read",value:function(e,t){var n=0;for(this.channelId=e.readUInt32BE(t),n+=4;t+n<e.length;){var a=e.readUInt8(t+n);if(n+=1,a===B.g.EndOption)break;var i=new(0,C[a]);n+=i.read(e,t+n),this.options.push(i)}return n}},{key:"byteLength",value:function(){return this.options.reduce(function(e,t){return e+t.byteLength()+1},0)+5}},{key:"write",value:function(e,t){var n=0;return e.writeUInt32BE(this.channelId,t),n+=4,this.options.forEach(function(a){e.writeUInt8(a.type,t+n),n+=1,a.write(e,t+n),n+=a.byteLength()}),e.writeUInt8(B.g.EndOption,t+n),n+=1}}]),e}(),E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();Object(c.a)(this,e),this.value=t}return Object(o.a)(e,[{key:"read",value:function(e,t){var n=e.readInt32BE(t),a=e.readInt32BE(t+4);return this.value=1e3*n+a/1e6,8}},{key:"byteLength",value:function(){return 8}},{key:"write",value:function(e,t){e.writeInt32BE(Math.floor(this.value/1e3),t),e.writeInt32BE(this.value%1e3*1e6,t+4)}}]),e}(),I=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new E;Object(c.a)(this,t),this.type=B.f.DATA,this.address=n,this.data=M.Buffer.from(a),this.timestamp=i}return Object(o.a)(t,[{key:"read",value:function(e,t){var n=this.address.read(e,t);t+=n+=this.timestamp.read(e,t+n);var a=Math.min(this.address.rangeByteLength(),e.length-t);return this.data=e.slice(t,t+a),n+a}},{key:"byteLength",value:function(){return this.address.byteLength()+this.data.length+8}},{key:"write",value:function(e,t){var n=0;this.address.write(e,t),n+=this.address.byteLength(),this.timestamp.write(e,t+n),n+=this.timestamp.byteLength(),this.data.copy(e,t+n)}}]),t}(),A=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;Object(c.a)(this,t),this.address=n}return Object(o.a)(t,[{key:"read",value:function(e,t){return this.address.read(e,t)}},{key:"byteLength",value:function(){return this.address.byteLength()}},{key:"write",value:function(e,t){this.address.write(e,t)}}]),t}(),R=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E;Object(c.a)(this,t),this.type=B.f.ACK,this.address=n,this.delaySample=a}return Object(o.a)(t,[{key:"read",value:function(e,t){var n=this.address.read(e,t);return n+=this.delaySample.read(e,t+n)}},{key:"byteLength",value:function(){return this.address.byteLength()+this.delaySample.byteLength()}},{key:"write",value:function(e,t){this.address.write(e,t),this.delaySample.write(e,t+this.address.byteLength())}}]),t}(),D=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(l.a)(t).call(this,e))).type=B.f.HAVE,n}return Object(d.a)(t,e),t}(A),L=function(){function n(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;Object(c.a)(this,n),this.type=B.f.INTEGRITY,this.address=a,this.hash=i}return Object(o.a)(n,[{key:"read",value:function(e,t){var n=this.address.read(e,t);return n+=this.hash.read(e,t+n)}},{key:"byteLength",value:function(){return this.address.byteLength()+this.hash.byteLength()}},{key:"write",value:function(e,t){this.address.write(e,t),this.hash.write(e,t+this.address.byteLength())}}]),n}(),x=function(){function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new E,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new n;Object(c.a)(this,t),this.type=B.f.SIGNED_INTEGRITY,this.address=a,this.timestamp=i,this.signature=r}return Object(o.a)(t,[{key:"read",value:function(e,t){var n=this.address.read(e,t);return n+=this.timestamp.read(e,t+n),n+=this.signature.read(e,t+n)}},{key:"byteLength",value:function(){return this.address.byteLength()+this.timestamp.byteLength()+this.signature.byteLength()}},{key:"write",value:function(e,t){var n=0;this.address.write(e,t),n+=this.address.byteLength(),this.timestamp.write(e,t+n),n+=this.timestamp.byteLength(),this.signature.write(e,t+n)}}]),t}(),T=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(l.a)(t).call(this,e))).type=B.f.REQUEST,n}return Object(d.a)(t,e),t}(A),N=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(l.a)(t).call(this,e))).type=B.f.CANCEL,n}return Object(d.a)(t,e),t}(A),P=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"read",value:function(){return 0}},{key:"byteLength",value:function(){return 0}},{key:"write",value:function(){}}]),e}(),H=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this))).type=B.f.CHOKE,e}return Object(d.a)(t,e),t}(P),q=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this))).type=B.f.UNCHOKE,e}return Object(d.a)(t,e),t}(P),U=(r={},Object(s.a)(r,B.f.HANDSHAKE,S),Object(s.a)(r,B.f.DATA,I),Object(s.a)(r,B.f.ACK,R),Object(s.a)(r,B.f.HAVE,D),Object(s.a)(r,B.f.INTEGRITY,L),Object(s.a)(r,B.f.SIGNED_INTEGRITY,x),Object(s.a)(r,B.f.REQUEST,T),Object(s.a)(r,B.f.CANCEL,N),Object(s.a)(r,B.f.CHOKE,H),Object(s.a)(r,B.f.UNCHOKE,q),r),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(c.a)(this,e),this.values=t,this.buffer=null,this.offset=0}return Object(o.a)(e,[{key:"next",value:function(){if(!(this.offset>=this.buffer.length)){var e=this.buffer.readUInt8(this.offset);this.offset+=1;var t=new(0,U[e]);return this.values.push(t),this.offset+=t.read(this.buffer,this.offset),t}}},{key:"toArray",value:function(){for(;this.next(););return this.values}},{key:"read",value:function(e,t){return this.buffer=e,this.offset=t,0}},{key:"byteLength",value:function(){return this.values.reduce(function(e,t){return e+t.byteLength()+1},0)}},{key:"write",value:function(e,t){var n=0;return this.values.forEach(function(a){e.writeUInt8(a.type,t+n),n+=1,a.write(e,t+n),n+=a.byteLength()}),n}}],[{key:"from",value:function(t){if(t instanceof e)return t;if(Array.isArray(t))return new e(t);throw new Error("unable to create Messages from unsupported type")}}]),e}();return{VersionProtocolOption:v,MinimumVersionProtocolOption:p,SwarmIdentifierProtocolOption:g,ContentIntegrityProtectionMethodProtocolOption:b,MerkleHashTreeFunctionProtocolOption:m,LiveSignatureAlgorithmProtocolOption:y,ChunkAddressingMethodProtocolOption:k,LiveDiscardWindowProtocolOption:O,SupportedMessagesProtocolOption:w,ChunkSizeProtocolOption:j,HandshakeMessage:S,Timestamp:E,DataMessage:I,AckMessage:R,HaveMessage:D,IntegrityMessage:L,SignedIntegrityMessage:x,RequestMessage:T,CancelMessage:N,ChokeMessage:H,UnchokeMessage:q,Datagram:function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.a)(this,e),this.channelId=t,this.messages=_.from(n)}return Object(o.a)(e,[{key:"read",value:function(e){var t=M.Buffer.from(e),n=0;return this.channelId=t.readUInt32BE(0),n+=4,n+=this.messages.read(t,n)}},{key:"byteLength",value:function(){return this.messages.byteLength()+4}},{key:"write",value:function(e){var t=0;return e.writeUInt32BE(this.channelId,0),t+=4,t+=this.messages.write(e,t)}},{key:"toBuffer",value:function(){var e=M.Buffer.alloc(this.byteLength());return this.write(e),e}}],[{key:"from",value:function(t){var n=new e;return n.read(t),n}}]),e}(),LiveSignature:n,IntegrityHash:t,ChunkAddress:e}},q=n(31);function U(e){for(var t=0,n=0;n<e;n++)t=t<<1|1;return t}function _(e,t,n){return n?e|t:e&(255^t)}var z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(c.a)(this,e),this.offset=0,this.resize(t)}return Object(o.a)(e,[{key:"resize",value:function(e){this.capacity=e,this.values=new Uint8Array(Math.ceil(e/8))}},{key:"adjustOffset",value:function(e){var t=this.offset,n=e-t-this.capacity;n<=0||(this.offset+=n,this.unsafelySetRange(t+1,t+n+1,!1))}},{key:"getByteIndex",value:function(e){return Math.floor(e/8)%this.values.length}},{key:"getBitIndex",value:function(e){return e%8}},{key:"getIndexValue",value:function(e,t){var n=this.offset%(8*this.values.length);return(e<n?this.offset+8*this.values.length-n:this.offset)+(8*e+t)}},{key:"setRange",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t-e!==1?t<=this.offset||(e=Math.max(e,this.offset),this.adjustOffset(t),this.unsafelySetRange(e,t,n)):this.set(e,n)}},{key:"unsafelySetRange",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t-e>=this.capacity)this.values.fill(n?255:0);else{var a=this.getByteIndex(e),i=this.getByteIndex(t),r=this.getBitIndex(e),s=this.getBitIndex(t);if(a>i)return this.unsafelySetIndexRange(a,r,this.capacity,0,n),void this.unsafelySetIndexRange(0,0,i,s,n);this.unsafelySetIndexRange(a,r,i,s,n)}}},{key:"unsafelySetIndexRange",value:function(e,t,n,a,i){var r=U(8-t),s=255^U(8-a);if(e!==n)this.values[e]=_(this.values[e],r,i),this.values[n]=_(this.values[n],s,i),n-e>1&&this.values.fill(i?255:0,e+1,n);else{var u=r&s;this.values[e]=_(this.values[e],u,i)}}},{key:"unsetRange",value:function(e,t){this.setRange(e,t,!1)}},{key:"set",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(e<this.offset)){this.adjustOffset(e);var n=this.getByteIndex(e),a=1<<7-this.getBitIndex(e);this.values[n]=_(this.values[n],a,t)}}},{key:"unset",value:function(e){this.set(e,!1)}},{key:"get",value:function(e){if(e<=this.offset||e>this.offset+this.capacity)return!1;var t=this.getByteIndex(e),n=1<<7-this.getBitIndex(e);return 0!==(this.values[t]&n)}},{key:"toValueArray",value:function(){for(var e=[],t=1;t<=this.capacity;t++)this.get(this.offset+t)&&e.push(this.offset+t);return e}},{key:"min",value:function(){for(var e=this.offset;e<=this.offset+this.capacity;e+=8)if(0!==this.values[this.getByteIndex(e)])for(var t=8*Math.floor(e/8),n=t;n<t+8;n++)if(this.get(n))return n;return 1/0}},{key:"max",value:function(){for(var e=this.capacity+this.offset;e>=this.offset;e-=8)if(0!==this.values[this.getByteIndex(e)])for(var t=8*Math.ceil(e/8)+1,n=t;n>t-8;n--)if(this.get(n))return n;return-1/0}}]),e}(),V=function(){function e(){Object(c.a)(this,e),this.lastVirtualFinish=0,this.nextVirtualFinish=1/0,this.queue=[]}return Object(o.a)(e,[{key:"computeWeight",value:function(){return 1}}]),e}(),K={Queue:function(){function e(t){Object(c.a)(this,e),this.rate=t,this.totalQueueSize=0,this.flows=[]}return Object(o.a)(e,[{key:"addFlow",value:function(e){return this.flows.push(e)}},{key:"removeFlow",value:function(e){var t=this.flows.indexOf(e);-1!==t&&this.flows.splice(t,1)}},{key:"enqueue",value:function(e,t,n){var a=e.computeWeight(this),i=this.rate/a,r=Math.max(Date.now(),e.lastVirtualFinish)+t/i;e.queue.push({virtualFinish:r,size:t,value:n}),e.lastVirtualFinish=r,1===e.queue.length&&(e.nextVirtualFinish=r)}},{key:"getNextScheduledFlow",value:function(){for(var e=1/0,t=null,n=0;n<this.flows.length;n++)this.flows[n].nextVirtualFinish<e&&(e=(t=this.flows[n]).nextVirtualFinish);return t}},{key:"peek",value:function(){var e=this.getNextScheduledFlow();return null===e?null:{flow:e,task:e.queue[0]}}},{key:"dequeue",value:function(){var e=this.getNextScheduledFlow();if(null===e)return null;var t=e.queue.shift();return e.nextVirtualFinish=0!==e.queue.length?e.queue[0].virtualFinish:1/0,{flow:e,task:t}}}]),e}(),Flow:V},W=function(){function e(t){Object(c.a)(this,e),this.values=new z(t)}return Object(o.a)(e,[{key:"setCapacity",value:function(e){this.values.resize(e)}},{key:"set",value:function(e,t){this.values.setRange(e.start/2,e.end/2+1,t)}},{key:"get",value:function(e){for(var t=e.start,n=e.end,a=void 0===n?t:n,i=t;i<=a;i+=2)if(!this.values.get(i/2))return!1;return!0}},{key:"min",value:function(){return 2*this.values.min()}},{key:"max",value:function(){return 2*this.values.max()}}]),e}(),F=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"advanceLastBin",value:function(e){Object(q.a)(Object(l.a)(t.prototype),"advanceLastIndex",this).call(this,e/2)}},{key:"setRange",value:function(e,n){for(var a=e.start,i=0;i<n.length;i++)Object(q.a)(Object(l.a)(t.prototype),"set",this).call(this,a/2+i,n[i])}},{key:"set",value:function(e,n){var a=e.bin;Object(q.a)(Object(l.a)(t.prototype),"set",this).call(this,a/2,n)}},{key:"get",value:function(e){var n=e.bin;return Object(q.a)(Object(l.a)(t.prototype),"get",this).call(this,n/2)}},{key:"forEach",value:function(e){for(var t=this.lastIndex-this.capacity;t<this.lastIndex&&!1!==e(this.get(t),2*t);t++);}}]),t}(y),G=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;Object(c.a)(this,e),this.firstSampleWindow=Math.floor(Date.now()/n),this.lastSampleWindow=this.firstSampleWindow,this.windowMs=t,this.sampleWindowMs=n,this.sum=0,this.values=new Array(Math.ceil(t/n)),this.values.fill(0)}return Object(o.a)(e,[{key:"adjustSampleWindow",value:function(){for(var e=Math.floor(Date.now()/this.sampleWindowMs),t=this.lastSampleWindow+1;t<=e;t++){var n=t%this.values.length;this.sum-=this.values[n],this.values[n]=0}this.lastSampleWindow=e}},{key:"update",value:function(e){this.adjustSampleWindow(),this.sum+=e,this.values[this.lastSampleWindow%this.values.length]+=e}},{key:"value",value:function(){this.adjustSampleWindow();var e=Math.min((this.lastSampleWindow-this.firstSampleWindow)*this.sampleWindowMs,this.windowMs);return this.sum/e}}]),e}(),Q=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this,n))).lastEndBin=0,e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"update",value:function(e){var n=e.start,a=e.end;0===this.lastHeadBin?Object(q.a)(Object(l.a)(t.prototype),"update",this).call(this,(a-n)/2):a>this.lastEndBin&&(Object(q.a)(Object(l.a)(t.prototype),"update",this).call(this,(a-this.lastEndBin)/2),this.lastEndBin=a)}}]),t}(G),Y=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(l.a)(t).call(this))).id=e,n.queueSize=0,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"computeWeight",value:function(e){return this.queueSize/e.totalQueueSize}}]),t}(K.Flow),J=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(h.a)(this,Object(l.a)(t).call(this,e))).totalQueueSize=0,n}return Object(d.a)(t,e),Object(o.a)(t,[{key:"enqueue",value:function(e,n,a){this.totalQueueSize+=n,e.queueSize+=n,Object(q.a)(Object(l.a)(t.prototype),"enqueue",this).call(this,e,n,a)}},{key:"cancel",value:function(e,t){var n=this;e.queue=e.queue.filter(function(a){var i=t(a.value);return i&&(n.totalQueueSize-=a.size,e.queueSize-=a.size),!i})}},{key:"dequeue",value:function(){var e=Object(q.a)(Object(l.a)(t.prototype),"dequeue",this).call(this);return null===e?null:(this.totalQueueSize-=e.task.size,e.flow.queueSize-=e.task.size,e)}}]),t}(K.Queue),X=function(){function e(t){Object(c.a)(this,e),this.bin=t,this.reset()}return Object(o.a)(e,[{key:"reset",value:function(){this.availableCopies=0,this.requestTime=[0,0],this.requestPeerId=0,this.requested=!1,this.received=!1,this.verified=!1}}]),e}(),Z=function(){function e(){Object(c.a)(this,e),this.valueByBin={},this.head=void 0,this.tail=void 0,this.length=0}return Object(o.a)(e,[{key:"insert",value:function(e){for(var t=Date.now(),n=e.start;n<=e.end;n+=2){var a={address:new g.a(n),createdAt:t,next:void 0,prev:void 0};this.valueByBin[n]=a,void 0===this.head?this.head=a:this.tail.next=a,a.prev=this.tail,this.tail=a,this.length++}}},{key:"get",value:function(e){var t=e.bin;return this.valueByBin[t]}},{key:"remove",value:function(e){var t=e.bin,n=this.valueByBin[t];void 0!==n&&(delete this.valueByBin[t],this.head===n&&(this.head=n.next),this.tail===n&&(this.tail=n.prev),void 0!==n.prev&&(n.prev.next=n.next),void 0!==n.next&&(n.next.prev=n.prev),this.length--)}},{key:"peek",value:function(){return this.head}},{key:"pop",value:function(){if(void 0!==this.head){var e=this.head;return this.head=e.next,this.tail===e&&(this.tail=e.prev),void 0!==e.next&&(e.next.prev=void 0),delete this.valueByBin[e.address.bin],this.length--,e}}}]),e}(),$=function(e){function t(){return Object(c.a)(this,t),Object(h.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(o.a)(t,[{key:"createEmptyValue",value:function(e,t){return void 0===t?new X(e):(t.reset(),t)}}]),t}(F),ee=function e(t,n){Object(c.a)(this,e),this.peer=t,this.requestFlow=n,this.availableChunks=new W,this.ledbat=new D,this.rttMean=new m(.05),this.rttVar=new m(.05),this.chunkIntervalMean=new m(.25),this.chunkRate=new G(15e3),this.wasteRate=new G(15e3),this.lastChunkTime=null,this.requestTimes=new F,this.requestedChunks=new Z,this.sentRequests=new Z,this.timeouts=0,this.validChunks=0,this.invalidChunks=0,this.requestQueue=[],this.sentChunks=new W,this.receivedChunks=new W},te=function(){function e(t,n){Object(c.a)(this,e);var a=n.liveDiscardWindow,i=n.uploadRateLimit;this.chunkSize=t,this.liveDiscardWindow=a,this.peerStates={},this.chunkStates=new $(a),this.loadedChunks=new W(a),this.peerCount=0,this.chunkRate=new Q,this.requestQueue=new J(i/1e3),this.timers={},this.lastExportedBin=-1/0,this.lastCompletedBin=-1/0,this.requestedChunks=new W(a),this.totalSends=0,this.totalRequests=0,this.totalRequestsReceived=0,this.totalReceived=0,this.totalAdded=0,this.totalCancelled=0,this.ackUnknownSend=0,this.totalDroppedRequests=0,this.sendDelay=new m(.05),this.nextSendTime=0,this.nextSendTimeout=0}return Object(o.a)(e,[{key:"debug",value:function(){var e=this;console.log("---"),Object.values(this.peerStates).forEach(function(t){if(t.peer.isReady()){var n=t.ledbat.cto/(t.ledbat.cwnd/e.chunkSize),a=Math.ceil(Math.min(n,1e3)),i=t.availableChunks,r=e.loadedChunks.min(),s=e.requestedChunks.min(),u=Math.max(i.min(),isFinite(r)?r:-1/0,isFinite(s)?r:-1/0,e.lastCompletedBin),c=Math.min(i.max(),u+2*e.liveDiscardWindow),o=Math.min(1e3,4*t.ledbat.rttMean.value()),h=t.chunkIntervalMean.value()||0,l=(0===h?1:Math.max(1,o/h))-t.sentRequests.length;console.log(JSON.stringify({peer_remoteId:t.peer.remoteId,peer_localId:t.peer.localId,sentRequests:t.sentRequests.length,swift_rtt:t.rttMean.value(),swift_rttvar:t.rttVar.value(),swift_chunkIntervalMean:t.chunkIntervalMean.value(),chunkRate:t.chunkRate.value(),wasteRate:t.wasteRate.value(),swift_cwnd:l,ledbat_cwnd:t.ledbat.cwnd,ledbat_cto:t.ledbat.cto,ledbat_currentDelay:t.ledbat.currentDelay.getMin(),ledbat_baseDelay:t.ledbat.baseDelay.getMin(),ledbat_rttMean:t.ledbat.rttMean.value(),ledbat_rttVar:t.ledbat.rttVar.value(),ledbat_rtt:t.ledbat.rtt,ledbat_flightSize:t.ledbat.flightSize,timeouts:t.timeouts,validChunks:t.validChunks,invalidChunks:t.invalidChunks,timeout:a,picker_startBin:u,picker_lastAvailableBin:c},!0,2))}}),console.log(JSON.stringify({totalSends:this.totalSends,totalRequests:this.totalRequests,totalRequestsReceived:this.totalRequestsReceived,totalDroppedRequests:this.totalDroppedRequests,totalReceived:this.totalReceived,totalAdded:this.totalAdded,totalCancelled:this.totalCancelled,ackUnknownSend:this.ackUnknownSend,minIncompleteBin:this.lastCompletedBin,sendDelay:this.sendDelay.value(),picker_firstLoadedChunk:this.loadedChunks.min(),picker_firstRequestedChunk:this.requestedChunks.min(),chunkRate:this.chunkRate.value()},!0,2))}},{key:"update",value:function(e,t){var n=this;if(e.peer.isReady()){for(var a=e.availableChunks,i=e.ledbat,r=e.sentRequests,s=Date.now(),u=Math.max(1e3,4*i.rttMean.value()),c=s-2*i.cto,o=e.chunkIntervalMean.value()||0,h=(0===o?1:Math.max(1,u/o))-r.length,l=[];void 0!==r.peek()&&r.peek().createdAt<c;)l.push(r.pop());l.length>0&&(this.totalCancelled+=l.length,l.forEach(function(e){var t=e.address;n.requestedChunks.set(t,!1),r.remove(t)}),i.onDataLoss(l.length*this.chunkSize)),i.digestDelaySamples();for(var d,f=Math.max(2*this.loadedChunks.values.offset+2,2*this.requestedChunks.values.offset+2,a.min(),this.lastCompletedBin),v=Math.min(f+2*this.liveDiscardWindow,a.max()),p=[],b=f;b<v&&p.length<h;b+=2){var m=new g.a(b);this.loadedChunks.get(m)||this.requestedChunks.get(m)||!a.get(m)||Math.random()<.05&&(p.push(m),r.insert(m),this.requestedChunks.set(m))}if(this.lastCompletedBin===-1/0&&0!==p.length){var y=p[0].bin;this.lastCompletedBin=y,this.lastExportedBin=y-2}if(0!==l.length&&l.forEach(function(t){var a=t.address;n.requestedChunks.set(a,!1),e.peer.sendCancel(a)}),0!==p.length)this.totalRequests+=p.length,(d=e.peer).sendRequest.apply(d,p),p.forEach(function(t){void 0===e.requestTimes.get(t)&&e.requestTimes.set(t,s)});for(;i.flightSize<i.cwnd&&e.requestQueue.length;){var k=e.requestQueue.shift();if(void 0!==k){var O=e.requestedChunks.get(k);void 0!==O&&(O.sentAt=s,e.ledbat.addSent(this.chunkSize),e.peer.sendChunk(k),this.totalSends++)}e.sentChunks.set(k)}e.peer.flush();var w=Math.min(1e3,(i.rttMean.value()||0)/(i.cwnd/this.chunkSize));this.timers[e.localId]=setTimeout(t,w)}else this.timers[e.localId]=setTimeout(t,1e3)}},{key:"addPeer",value:function(e){var t=this,n=e.localId,a=new Y(n);this.requestQueue.addFlow(a);var i=new ee(e,a);this.peerStates[n]=i;this.timers[n]=setTimeout(function e(){return t.update(i,e)},1e3)}},{key:"removePeer",value:function(e){var t=e.localId,n=this.peerStates[t];if(void 0!==n){var a=n.requestFlow,i=n.sentRequests;for(this.requestQueue.removeFlow(a),this.totalCancelled+=i.length;i.length;){var r=i.pop().address;this.requestedChunks.set(r,!1)}delete this.peerStates[t],clearTimeout(this.timers[t])}}},{key:"getPeerState",value:function(e){var t=e.localId;return this.peerStates[t]}},{key:"getRecentChunks",value:function(){var e=this.loadedChunks.max()-64;if(!isFinite(e))return[];for(var t=[],n=this.loadedChunks.max(),a=e;a<=n;a+=2){var i=new g.a(a);this.loadedChunks.get(i)&&t.push(i)}return t}},{key:"setLiveDiscardWindow",value:function(e,t){this.getPeerState(e).availableChunks.setCapacity(t),this.getPeerState(e).requestTimes.setCapacity(t),this.getPeerState(e).sentChunks.setCapacity(t),this.getPeerState(e).receivedChunks.setCapacity(t)}},{key:"markChunkReceived",value:function(e,t,n){var a=Date.now();this.totalReceived++;var i=this.getPeerState(e);if(void 0!==i&&(this.loadedChunks.get(t)&&i.wasteRate.update(1),void 0!==i.sentRequests.get(t))){if(null!==i.lastChunkTime){var r=a-i.lastChunkTime;i.chunkIntervalMean.update(r)}i.lastChunkTime=a,this.loadedChunks.get(t)||i.chunkRate.update(1);var s=i.requestTimes.get(t);void 0!==s&&i.ledbat.addRttSample(a-s),i.sentRequests.remove(t)}}},{key:"markChunkVerified",value:function(e,t){this.getPeerState(e).validChunks++,this.getPeerState(e).receivedChunks.set(t),this.chunkRate.update(t),this.loadedChunks.set(t);for(var n=this.lastCompletedBin;this.loadedChunks.get(new g.a(n));n+=2)this.lastCompletedBin=n;Object.values(this.peerStates).forEach(function(e){var n=e.availableChunks,a=e.peer;!n.get(t)&&a.isReady()&&a.sendHave(t)})}},{key:"getNewCompleteBins",value:function(){var e=this.lastExportedBin+2;if(e<=this.lastCompletedBin)return this.lastExportedBin=this.lastCompletedBin,[e,this.lastCompletedBin]}},{key:"markChunkRejected",value:function(e,t){this.requestedChunks.set(t,!1),this.getPeerState(e).invalidChunks++}},{key:"markChunkAvailable",value:function(e,t){for(var n=t.start;n<=t.end;n+=2)this.getPeerState(e).availableChunks.get(new g.a(n))||this.totalAdded++;this.getPeerState(e).availableChunks.set(t)}},{key:"markChunksLoaded",value:function(e){this.chunkStates.advanceLastBin(e.end),this.loadedChunks.set(e),Object.values(this.peerStates).forEach(function(t){var n=t.availableChunks,a=t.peer;!n.get(e)&&a.isReady()&&a.sendHave(e)})}},{key:"markSendAcked",value:function(e,t,n){var a=this.getPeerState(e);a.ledbat.addDelaySample(n,this.chunkSize);var i=a.requestedChunks.get(t);void 0!==i?(i.sentAt&&a.ledbat.addRttSample(Date.now()-i.sentAt),a.requestedChunks.remove(t)):this.ackUnknownSend++}},{key:"enqueueRequest",value:function(e,t){for(var n=this.getPeerState(e),a=t.start;a<=t.end;a+=2)this.totalRequestsReceived++,n.requestQueue.push(new g.a(a));n.requestedChunks.insert(t)}},{key:"cancelRequest",value:function(e,t){var n=this.getPeerState(e),a=n.requestedChunks.get(t);a&&a.sentAt&&n.ledbat.onDataLoss(this.chunkSize),n.requestedChunks.remove(t)}}]),e}();n.d(t,"b",function(){return ae}),n.d(t,"a",function(){return ce});var ne=H(),ae=function(e){function t(e,n){var a;Object(c.a)(this,t),a=Object(h.a)(this,Object(l.a)(t).call(this));var i=e.swarmId,r=e.protocolOptions,s=r[B.g.ContentIntegrityProtectionMethod],u=r[B.g.MerkleHashTreeFunction],o=r[B.g.LiveSignatureAlgorithm],d=r[B.g.ChunkAddressingMethod],f=r[B.g.ChunkSize],v=n.liveDiscardWindow,p=n.privateKey;a.uri=e,a.encoding=H(x(d,f),P(u),N(o,i));var g=void 0!==p?Object(L.c)(o,p):void 0;return a.contentIntegrity=Object(L.b)(s,Object(L.e)(u),Object(L.d)(o,i),g,v),a.chunkBuffer=new F(v),a.scheduler=new te(f,n),a.protocolOptions=[new a.encoding.VersionProtocolOption,new a.encoding.MinimumVersionProtocolOption,new a.encoding.SwarmIdentifierProtocolOption(i.toBuffer()),new a.encoding.ContentIntegrityProtectionMethodProtocolOption(s),new a.encoding.MerkleHashTreeFunctionProtocolOption(u),new a.encoding.LiveSignatureAlgorithmProtocolOption(o),new a.encoding.ChunkAddressingMethodProtocolOption(d),new a.encoding.ChunkSizeProtocolOption(f),new a.encoding.LiveDiscardWindowProtocolOption(v)],a}return Object(d.a)(t,e),Object(o.a)(t,[{key:"verifyProtocolOptions",value:function(e){Object.entries(this.uri.protocolOptions).forEach(function(t){var n=Object(u.a)(t,2),a=n[0],i=n[1];if(e[a]!==i){var r=B.g.name(a);throw new Error("invalid peer options: ".concat(r," mismatch"))}})}},{key:"emitNewData",value:function(){var e=this.scheduler.getNewCompleteBins();if(void 0!==e){for(var t=Object(u.a)(e,2),n=t[0],a=t[1],i=[],r=n;r<=a;r+=2){var s=this.chunkBuffer.get(new g.a(r));i.push(s)}this.emit("data",i)}}}]),t}(f.EventEmitter),ie={CONNECTING:1,AWAITING_HANDSHAKE:2,READY:3,CHOKED:4,DISCONNECTING:5,CLOSED:6},re=function(){function e(t){Object(c.a)(this,e),this.swarm=t,this.integrityVerifier=null}return Object(o.a)(e,[{key:"getContentIntegrityVerifier",value:function(e){return null===this.integrityVerifier&&(this.integrityVerifier=this.swarm.contentIntegrity.createVerifier(e)),this.integrityVerifier}}]),e}(),se=function(){function e(t,n){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.createChannelId();Object(c.a)(this,e),this.swarm=t,this.channel=n,this.remoteId=i,this.localId=r,this.state=ie.CONNECTING,this.handlers=(a={},Object(s.a)(a,B.f.HANDSHAKE,this.handleHandshakeMessage.bind(this)),Object(s.a)(a,B.f.DATA,this.handleDataMessage.bind(this)),Object(s.a)(a,B.f.HAVE,this.handleHaveMessage.bind(this)),Object(s.a)(a,B.f.ACK,this.handleAckMessage.bind(this)),Object(s.a)(a,B.f.INTEGRITY,this.handleIntegrityMessage.bind(this)),Object(s.a)(a,B.f.SIGNED_INTEGRITY,this.handleSignedIntegrityMessage.bind(this)),Object(s.a)(a,B.f.REQUEST,this.handleRequestMessage.bind(this)),Object(s.a)(a,B.f.CANCEL,this.handleCancelMessage.bind(this)),Object(s.a)(a,B.f.CHOKE,this.handleChokeMessage.bind(this)),Object(s.a)(a,B.f.UNCHOKE,this.handleUnchokeMessage.bind(this)),a),this.sendBuffer=[],this.swarm.scheduler.addPeer(this)}return Object(o.a)(e,[{key:"init",value:function(){this.sendHandshake(),this.flush(),this.state=ie.AWAITING_HANDSHAKE}},{key:"close",value:function(){this.state=ie.CLOSED,this.swarm.scheduler.removePeer(this)}},{key:"handleData",value:function(e){var t=this,n=new re(this.swarm);e.messages.toArray().forEach(function(e){return t.handleMessage(e,n)})}},{key:"handleMessage",value:function(e,t){var n=this.handlers[e.type];if(void 0===n)throw new Error("unsupported message type");n(e,t)}},{key:"handleHandshakeMessage",value:function(e){var t=this,n=e.options.reduce(function(e,t){var n=t.type,a=t.value;return Object(r.a)({},e,Object(s.a)({},n,a))},{}),a=n[B.g.LiveDiscardWindow];void 0!==a&&this.swarm.scheduler.setLiveDiscardWindow(this,a),this.swarm.verifyProtocolOptions(n),this.remoteId=e.channelId,this.state!==ie.READY&&(this.sendHandshake(),this.swarm.scheduler.getRecentChunks().forEach(function(e){return t.sendHave(e)}),this.flush()),this.state=ie.READY}},{key:"handleDataMessage",value:function(e,t){var n=this,a=g.a.from(e.address),i=D.computeOneWayDelay(e.timestamp.value);this.swarm.scheduler.markChunkReceived(this,a,i);var r=this.swarm.encoding;this.channel.send(new r.Datagram(this.remoteId,[new r.AckMessage(e.address,new r.Timestamp(i))])),t.getContentIntegrityVerifier(a).verifyChunk(a,e.data).then(function(){n.swarm.chunkBuffer.set(a,e.data),n.swarm.scheduler.markChunkVerified(n,a),n.swarm.emitNewData()}).catch(function(e){console.log("error validating chunk",e),n.swarm.scheduler.markChunkRejected(n,a)})}},{key:"handleHaveMessage",value:function(e){this.swarm.scheduler.markChunkAvailable(this,g.a.from(e.address))}},{key:"handleAckMessage",value:function(e){var t=g.a.from(e.address);this.swarm.scheduler.markChunkAvailable(this,t),this.swarm.scheduler.markSendAcked(this,t,e.delaySample.value)}},{key:"handleIntegrityMessage",value:function(e,t){var n=g.a.from(e.address);t.getContentIntegrityVerifier(n).setHash(n,e.hash.value)}},{key:"handleSignedIntegrityMessage",value:function(e,t){var n=g.a.from(e.address);t.getContentIntegrityVerifier(n).setHashSignature(n,e.signature.value)}},{key:"handleRequestMessage",value:function(e){this.swarm.scheduler.enqueueRequest(this,g.a.from(e.address))}},{key:"handleCancelMessage",value:function(e){this.swarm.scheduler.cancelRequest(this,g.a.from(e.address))}},{key:"handleChokeMessage",value:function(){this.state=ie.CHOKED}},{key:"handleUnchokeMessage",value:function(){this.state=ie.READY}},{key:"isReady",value:function(){return this.state===ie.READY}},{key:"isInitialized",value:function(){return this.state!==ie.CONNECTING&&this.state!==ie.AWAITING_HANDSHAKE}},{key:"sendHandshake",value:function(){var e=this.swarm.encoding;this.sendBuffer.push(new e.HandshakeMessage(this.localId,[].concat(Object(i.a)(this.swarm.protocolOptions),[new e.SupportedMessagesProtocolOption(Object.keys(this.handlers))])))}},{key:"sendHave",value:function(e){var t=this.swarm.encoding;this.sendBuffer.push(new t.HaveMessage(t.ChunkAddress.from(e)))}},{key:"sendRequest",value:function(){for(var e=this,t=this.swarm.encoding,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];a.forEach(function(n){e.sendBuffer.push(new t.RequestMessage(t.ChunkAddress.from(n)))})}},{key:"sendCancel",value:function(){for(var e=this,t=this.swarm.encoding,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];a.forEach(function(n){e.sendBuffer.push(new t.CancelMessage(t.ChunkAddress.from(n)))})}},{key:"sendChunk",value:function(e,t){var n=this,a=this.swarm.chunkBuffer.get(e);if(void 0!==a){var i=this.swarm.contentIntegrity.getConstituentSignatures(e);if(void 0!==i){var r=this.swarm.encoding;i.reverse().forEach(function(e,a){var i=e.bin,s=e.signature,u=r.ChunkAddress.from(new g.a(i));n.sendBuffer.push(new r.IntegrityMessage(u,new r.IntegrityHash(s.getHash()))),0===a&&n.sendBuffer.push(new r.SignedIntegrityMessage(u,new r.Timestamp(t),new r.LiveSignature(s.getSignatureHash())))}),this.sendBuffer.push(new r.DataMessage(r.ChunkAddress.from(e),a)),this.flush()}}}},{key:"flush",value:function(){if(0!==this.sendBuffer.length){var e=this.swarm.encoding;try{this.channel.send(new e.Datagram(this.remoteId,this.sendBuffer))}catch(t){throw console.log("error sending"),console.log(this.channel),t}this.sendBuffer=[]}}}],[{key:"createChannelId",value:function(){return Math.round(Math.random()*B.d)}}]),e}(),ue=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(h.a)(this,Object(l.a)(t).call(this))).setMaxListeners(1/0),e.swarms={},e}return Object(d.a)(t,e),Object(o.a)(t,[{key:"insert",value:function(e){var n=t.swarmIdToKey(e.uri.swarmId);void 0===this.swarms[n]&&(this.swarms[n]=e,this.emit("insert",e))}},{key:"remove",value:function(e){var n=t.swarmIdToKey(e.uri.swarmId);void 0!==this.swarms[n]&&(delete this.swarms[n],this.emit("remove",e))}},{key:"get",value:function(e){return this.swarms[t.swarmIdToKey(e)]}},{key:"toArray",value:function(){return Object.values(this.swarms)}}],[{key:"swarmIdToKey",value:function(e){return e.toBuffer().toString("base64")}}]),t}(f.EventEmitter),ce=function(){function e(){Object(c.a)(this,e),this.channels=[],this.swarms=new ue}return Object(o.a)(e,[{key:"publishSwarm",value:function(e){this.swarms.insert(e)}},{key:"unpublishSwarm",value:function(e){this.swarms.remove(e)}},{key:"joinSwarm",value:function(e){var t=e.protocolOptions[B.g.ChunkSize],n={liveDiscardWindow:Math.ceil(3e7/t),uploadRateLimit:1e6},a=new ae(e,n);return this.swarms.insert(a),a}},{key:"createChannel",value:function(e){var t=this,n=new oe(e,this.swarms);this.channels.push(n),n.once("close",function(){var e=t.channels.indexOf(n);t.channels.splice(e,1)})}}]),e}(),oe=function(e){function t(e,n){var i;Object(c.a)(this,t),(i=Object(h.a)(this,Object(l.a)(t).call(this))).conn=e,i.swarms=n,i.peers={},i.handleSwarmInsert=i.getOrCreatePeer.bind(Object(a.a)(i)),i.swarms.on("insert",i.handleSwarmInsert);var r=n.toArray();return i.conn.addEventListener("open",function(){return r.forEach(i.handleSwarmInsert)}),i.conn.addEventListener("message",i.handleMessage.bind(Object(a.a)(i))),i.conn.addEventListener("error",function(e){return console.log("connection error:",e)}),i.conn.addEventListener("close",i.handleClose.bind(Object(a.a)(i))),i}return Object(d.a)(t,e),Object(o.a)(t,[{key:"handleMessage",value:function(e){var t=new ne.Datagram;try{t.read(e.data)}catch(s){throw console.log(e.data),s}var n=this.peers[t.channelId];if(void 0===n){if(0!==t.channelId)return;var a;try{a=t.messages.next()}catch(u){return void console.log("error decoding mesasge",u)}if(void 0===a||a.type!==B.f.HANDSHAKE)return void console.log("rejected new peer without handshake");var i=a.options.find(function(e){return e.type===B.g.SwarmIdentifier});if(void 0===i)return;var r=this.swarms.get(b.a.from(i.value));if(void 0===r)return;n=this.getOrCreatePeer(r)}(t=new n.swarm.encoding.Datagram).read(e.data),n.handleData(t)}},{key:"send",value:function(e){var t=this;if("open"===this.conn.readyState)try{this.conn.send(e.toBuffer())}catch(n){this.conn.close()}else this.conn.addEventListener("open",function(){return t.conn.send(e.toBuffer())})}},{key:"handleClose",value:function(){this.swarms.removeListener("insert",this.handleSwarmInsert),Object.values(this.peers).forEach(function(e){return e.close()}),this.emit("close")}},{key:"getOrCreatePeer",value:function(e){return Object.values(this.peers).find(function(t){return t.swarm===e})||this.createPeer(e)}},{key:"createPeer",value:function(e){var t=this.peers,n=this.swarms,a=new se(e,this);t[a.localId]=a,a.init();var i=p()(function(){delete t[a.localId],a.close(),n.removeListener("remove",r)});setTimeout(function(){a.isInitialized()||i()},5e3);var r=function(t){t===e&&i()};return n.on("remove",r),a}}]),t}(f.EventEmitter)},62:function(e,t,n){"use strict";n.d(t,"a",function(){return S}),n.d(t,"b",function(){return I});var a=n(19),i=n(3),r=n(4),s=n(8),u=n(5),c=n(17),o=n(7),h=n(111),l=n.n(h),d=n(20),f=n(16),v=n.n(f),p=n(43),g=n.n(p),b=n(34),m=n.n(b),y=n(84),k=n.n(y),O=n(36),w=n(175),j=n.n(w),C=2,S=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this))).setMaxListeners(1/0),n.id=e,n.channels=new l.a({numberOfNodesPerKBucket:C,localNodeId:n.id}),n.allChannels=new l.a({numberOfNodesPerKBucket:100,localNodeId:n.id}),n.channels.on("ping",n.handlePing.bind(Object(c.a)(n))),n.channels.on("removed",n.handleRemoved.bind(Object(c.a)(n))),n.channels.on("updated",n.handleUpdated.bind(Object(c.a)(n))),n.channels.on("added",n.handleAdded.bind(Object(c.a)(n))),n.knownPeerIds={},n.channelMap={},n.seenIds=new k.a({max:1024}),n.knownRoutes=new k.a({max:1024,maxAge:6e4}),n.callbacks=new k.a({max:1024}),n.on("receive.peers.request",n.handlePeersRequest.bind(Object(c.a)(n))),n.on("receive.ping.request",n.handlePingRequest.bind(Object(c.a)(n))),n.on("receive.trace.request",n.handleTraceRequest.bind(Object(c.a)(n))),n.on("receive.callback.response",n.handleCallbackResponse.bind(Object(c.a)(n))),n.startPeerRequests(),n}return Object(o.a)(t,e),Object(r.a)(t,[{key:"close",value:function(){this.stopPeerRequests(),this.allChannels.toArray().forEach(function(e){var t=e.conn;return t&&t.close()}),this.emit("close"),this.removeAllListeners()}},{key:"startPeerRequests",value:function(){var e=this,t=0;this.peerRequestIvl=setInterval(function(){var n=function(){for(var n=Object.keys(e.knownPeerIds),a=0;a<=n.length;a++){t>=n.length&&(t=0);var i=n[t];if(t++,i)return i}}();n&&e.sendPeerRequest(Object(O.a)(n))},5e3)}},{key:"stopPeerRequests",value:function(){clearInterval(this.peerRequestIvl)}},{key:"handlePing",value:function(e,t){var n=this;e.forEach(function(e){var a=e.id;e.isOpen()?n.addChannel(e):setTimeout(function(){var e=n.getChannel(a);e&&e.isOpen()?n.addChannel(e):(n.removeChannel(a),n.addChannel(t))},1e4)})}},{key:"addChannel",value:function(e){this.channels.add(e),this.allChannels.add(e)}},{key:"removeChannel",value:function(e){this.channels.remove(e),this.allChannels.remove(e)}},{key:"getChannel",value:function(e){return this.channelMap[v()(e)]}},{key:"handleRemoved",value:function(e){e.conn&&e.conn.close()}},{key:"handleUpdated",value:function(e,t){}},{key:"handleAdded",value:function(e){void 0===e.conn&&this.emit("peers.discover",e.id)}},{key:"createChannel",value:function(e,t){var n=this,a=v()(e),i=new E(e,t),r=this.channelMap[a];r&&r.conn&&r.conn.close(),this.channelMap[a]=i;var s=[],u=function(e){return s.push(e)},c=this.handleMessage.bind(this,i),o=function(){n.addChannel(i),t.removeEventListener("message",u),t.addEventListener("message",c),s.forEach(c),n.sendPeerRequest(e)};t.addEventListener("message",u),t.addEventListener("open",o,{once:!0}),t.addEventListener("close",function(){t.removeEventListener("message",u),t.removeEventListener("message",c),t.removeEventListener("open",o),n.channelMap[a]===i&&(n.removeChannel(e),delete n.channelMap[a])},{once:!0})}},{key:"handleMessage",value:function(e,t){var n,i=this;e.lastActive=Date.now();try{n=JSON.parse(t.data)}catch(o){return}var r=n,s=r.type,u=r.id;if(n.trace&&n.trace.push(v()(this.id)),!this.seenIds.get(u)){this.seenIds.set(u,!0),this.getChannel(e.id)||console.warn("receiving channel is not known to dht",v()(e.id)),this.knownRoutes.set(n.from,e.id);var c=Object(O.a)(n.to);if(g()(c,this.id)){this.emit("receive.".concat(s),{data:n,callback:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=Object(O.a)(n.from),s=Object(a.a)({re:u},e);i.send(r,"callback.response",s,t)}})}else this.forwardMessage(c,n)}}},{key:"forwardMessage",value:function(e,t){t.hops>=10||(t.hops++,this.sendRaw(e,JSON.stringify(t),t.trace))}},{key:"sendPing",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.send(e,"ping.request",{},t)}},{key:"handlePingRequest",value:function(e){e.data;(0,e.callback)({})}},{key:"handleTraceRequest",value:function(e){var t=e.data;(0,e.callback)(t)}},{key:"handleCallbackResponse",value:function(e){var t=e.data,n=e.callback,a=this.callbacks.get(t.re);a&&a(t,n)}},{key:"sendPeerRequest",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=setTimeout(function(){delete t.knownPeerIds[v()(e)]},5e3);this.send(e,"peers.request",{count:n},function(e){clearTimeout(a),t.handlePeersResponse(e)})}},{key:"handlePeersRequest",value:function(e){var t=this,n=e.data,a=n.count,i=void 0===a?10:a,r=n.from,s=e.callback,u=Object(O.a)(r);s({ids:this.allChannels.closest(u).filter(function(e){return null!=e.conn}).filter(function(e){var n=e.id;return!g()(n,t.id)&&!g()(n,u)}).map(function(e){var t=e.id;return v()(t)}).slice(0,i)})}},{key:"handlePeersResponse",value:function(e){var t=this;e.ids.map(function(e){return Object(O.a)(e)}).filter(function(e){return!g()(e,t.id)}).filter(function(e){var n=t.getChannel(e);return null==n||null==n.conn}).forEach(function(e){t.knownPeerIds[v()(e)]=!0,t.addChannel(new E(e))})}},{key:"send",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;"function"===typeof n&&(i=n,n={});var r=v()(m()(16));this.seenIds.set(r,!0),null!=i&&this.callbacks.set(r,i);var s=JSON.stringify(Object(a.a)({id:r,type:t,from:v()(this.id),to:v()(e),trace:[v()(this.id)],hops:0},n));this.sendRaw(e,s)}},{key:"sendRaw",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=this.allChannels.closest(e).filter(function(e){return e.isOpen()}).filter(function(e){var t=e.idHex;return-1===n.indexOf(t)}).slice(0,2),i=this.knownRoutes.get(v()(e));if(i){var r=this.getChannel(i);null!=r&&r.isOpen()&&a.push(r)}0!==a.length&&(g()(a[0].id,e)&&(a=a.slice(0,1)),a.forEach(function(e){var n=e.id,a=e.conn;try{a.send(t)}catch(i){console.log("error sending to peer, closing",v()(n),i),a.close()}}))}}]),t}(d.EventEmitter),E=function(){function e(t,n){Object(i.a)(this,e),this.id=t,this.idHex=v()(t),this.vectorClock=Date.now(),this.lastPing=Date.now(),this.conn=n}return Object(r.a)(e,[{key:"isOpen",value:function(){var e=j()(this,function(e){return e.conn.readyState});return 1===e||"open"===e}}]),e}(),I=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v()(m()(16));Object(i.a)(this,e),this.client=t,this.peerId=n,this.id=a,this.readyState=e.ReadyStates.OPEN,this.onmessage=function(){},this.handleMessage=this.handleMessage.bind(this),this.client.on("receive.subchannel.message",this.handleMessage)}return Object(r.a)(e,[{key:"handleMessage",value:function(e){var t=e.data,n=t.channelId,a=t.data;n===this.id&&this.onmessage({data:a})}},{key:"send",value:function(e){this.client.send(this.peerId,"subchannel.message",{channelId:this.id,data:e})}},{key:"close",value:function(){this.readyState=e.ReadyStates.CLOSED,this.client.removeListener("receive.subchannel.message",this.handleMessage)}}]),e}();I.ReadyStates={OPEN:1,CLOSED:3}},79:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var a,i=n(19),r=n(9),s=n(3),u=n(4),c=n(6),o=n(110),h=n.n(o),l=n(55),d=n(2),f=(a={},Object(c.a)(a,d.g.ContentIntegrityProtectionMethod,"x.im"),Object(c.a)(a,d.g.MerkleHashTreeFunction,"x.hf"),Object(c.a)(a,d.g.LiveSignatureAlgorithm,"x.sa"),Object(c.a)(a,d.g.ChunkAddressingMethod,"x.am"),Object(c.a)(a,d.g.ChunkSize,"x.cs"),a),v=function(){function e(t,n){Object(s.a)(this,e),this.swarmId=t,this.protocolOptions=n}return Object(u.a)(e,[{key:"toString",value:function(){var e=h.a.encode(this.swarmId.toBuffer()),t=Object.entries(this.protocolOptions).map(function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return"".concat(f[n],"=").concat(a)}).join("&");return"magnet:?xt=urn:ppspp:".concat(e,"&").concat(t)}}],[{key:"parse",value:function(t){if(!t.startsWith("magnet:"))throw new Error("invalid uri: expected magnet");var n=t.substring(8).split("&").map(function(e){var t=e.split("="),n=Object(r.a)(t,2),a=n[0],i=n[1];return[a,decodeURIComponent(i)]}),a=Object.entries(f).reduce(function(e,t){var a=Object(r.a)(t,2),s=a[0],u=a[1],o=n.find(function(e){return Object(r.a)(e,1)[0]===u});if(void 0===o)throw new Error("invalid uri: missing ".concat(u));return Object(i.a)({},e,Object(c.a)({},s,parseFloat(o[1])))},{}),s=n.find(function(e){var t=Object(r.a)(e,2),n=t[0],a=t[1];return"xt"===n&&a.startsWith("urn:ppspp:")});if(void 0===s)throw new Error("invalid uri: missing suitable xt");return new e(l.a.from(h.a.decode(s[1].substring(10))),a)}}]),e}()},80:function(e,t,n){"use strict";var a=n(19),i=n(9),r=n(1),s=n.n(r),u=n(60),c=n.n(u);n(318);t.a=function(e){var t=e.spin,n=void 0!==t&&t,u=e.flicker,o=void 0!==u&&u,h=e.pulse,l=void 0!==h&&h,d=e.disabled,f=void 0!==d&&d,v=e.visible,p=void 0===v||v,g=e.blur,b=void 0!==g&&g,m=e.onClick,y=Object(r.useState)(!0),k=Object(i.a)(y,2),O=k[0],w=k[1];Object(r.useEffect)(function(){var e=setTimeout(function(){return w(p)},300);return function(){return clearTimeout(e)}},[p]);var j=Object(r.useReducer)(function(e,t){switch(t.type){case"ENTER":return Object(a.a)({},e,{index:e.index+1,hovering:!0,show:!1});case"LEAVE":return Object(a.a)({},e,{hovering:!1,show:!1});case"TIMEOUT":return e.hovering&&e.index===t.index?Object(a.a)({},e,{show:!0}):e;default:return e}},{index:0}),C=Object(i.a)(j,2),S=C[0],E=C[1];Object(r.useEffect)(function(){if(S.hovering){var e=setTimeout(function(){return E({type:"TIMEOUT",index:S.index})},3e3);return function(){return clearTimeout(e)}}},[S]);var I=c()({play_button_wrap:!0,hovering:S.show,disabled:f}),A=c()({play_button:!0,clickable:null!=m&&!f,exiting:!p&&O,hidden:!p&&!O,spin:n,flicker:o,pulse:l,blur:b,disabled:f});return s.a.createElement("div",{className:I},s.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 927 927",className:A,onClick:f?void 0:m,onMouseEnter:function(){return E({type:"ENTER"})},onMouseLeave:function(){return E({type:"LEAVE"})}},s.a.createElement("g",{className:"background"},s.a.createElement("circle",{cx:"463",cy:"463",r:"463"})),s.a.createElement("g",{className:"network"},s.a.createElement("circle",{cx:"327",cy:"229",r:"139"}),s.a.createElement("circle",{cx:"732",cy:"463",r:"139"}),s.a.createElement("circle",{cx:"327",cy:"697",r:"139"}),s.a.createElement("polygon",{points:"854 463 269 125 269 801 854 463"})),s.a.createElement("g",{className:"button"},s.a.createElement("path",{d:"M658,524c23-13,23-36,0-50L457,358c-23-13-43-2-43,25V616c0,27,19,38,43,25Z",transform:"translate(-45 -36)"}))))}},85:function(e,t,n){e.exports=n(106)?n(327):n(328)}},[[189,1,2]]]);
//# sourceMappingURL=main.a58710b7.chunk.js.map